---
task_key: T-E04-F05-001
status: todo
feature: /home/jwwelbor/projects/ai-dev-team/docs/plan/E04-task-mgmt-cli-core/E04-F05-folder-management
created: 2025-12-14
assigned_agent: general-purpose
dependencies: []
estimated_time: 4 hours
file_path: /home/jwwelbor/projects/ai-dev-team/docs/tasks/todo/T-E04-F05-001.md
---

# Task: Core Folder Structure & Path Management

## Goal

Implement the foundational folder structure management and path mapping utilities that ensure the PM CLI maintains six status-based folders (todo/, active/, blocked/, ready-for-review/, completed/, archived/) and provides cross-platform path resolution for task files.

## Success Criteria

- [ ] Six folders automatically created on initialization (todo/, active/, blocked/, ready-for-review/, completed/, archived/)
- [ ] `get_file_path_for_status()` function maps all six statuses to correct folder paths
- [ ] Cross-platform path handling using pathlib.Path
- [ ] Project root detection (searches for .git/ or .pmconfig.json)
- [ ] Folder creation is idempotent (no errors if folders already exist)
- [ ] All path operations complete in <100ms
- [ ] Unit tests cover all path mapping scenarios

## Implementation Guidance

### Overview

This task establishes the foundational folder structure that the entire file management system relies on. You'll implement automatic folder creation, status-to-folder mapping, and cross-platform path utilities. The implementation must be idempotent and handle edge cases like missing parent directories and permission issues.

### Key Requirements

- **Folder Structure**: Implement automatic folder creation as specified in [Architecture - Folder Structure](../../../docs/plan/E04-task-mgmt-cli-core/E04-F05-folder-management/02-architecture.md#32-folder-structure)
  - Base path: `docs/tasks/`
  - Six subfolders for each task status
  - Blocked folder addition (ADR-001)

- **Path Mapping**: Implement status-to-folder mapping as specified in [PRD - File Path Mapping](../../../docs/plan/E04-task-mgmt-cli-core/E04-F05-folder-management/prd.md#file-path-mapping)
  - STATUS_FOLDER_MAP constant with all six mappings
  - `get_file_path_for_status()` function
  - Task key to filename conversion

- **Project Root Detection**: Find project root by searching for:
  - `.git/` directory (version control)
  - `.pmconfig.json` file (PM CLI config marker)
  - Fail gracefully with clear error if not found

- **Cross-Platform Support**: Use pathlib.Path for all operations as specified in [PRD - Functional Requirements](../../../docs/plan/E04-task-mgmt-cli-core/E04-F05-folder-management/prd.md#functional-requirements)
  - Handle Windows backslashes and Unix forward slashes
  - No hardcoded path separators
  - Support absolute and relative paths

### Files to Create/Modify

**New Files**:
- `pm/file_management/__init__.py` - Package initialization
- `pm/file_management/folders.py` - Folder structure and path utilities (~200 lines)

**Folder Structure Created**:
- `docs/tasks/todo/`
- `docs/tasks/active/`
- `docs/tasks/blocked/`
- `docs/tasks/ready-for-review/`
- `docs/tasks/completed/`
- `docs/tasks/archived/`

### Integration Points

- **Task Operations** (E04-F03): Will call `get_file_path_for_status()` to determine file locations
- **Task Creation** (E04-F06): Will use folder utilities to place new task files
- **Validation** (T-E04-F05-003): Will scan these folders to detect mismatches

Reference [Architecture - Integration Points](../../../docs/plan/E04-task-mgmt-cli-core/E04-F05-folder-management/02-architecture.md#7-integration-points) for detailed integration patterns.

## Validation Gates

**Unit Tests**:
- Folder creation succeeds and is idempotent
- All six status values map to correct folders
- Task keys convert to valid filenames
- Path resolution works on different platforms
- Project root detection finds .git or .pmconfig.json
- Missing project root raises clear error

Reference [Architecture - Testing Strategy](../../../docs/plan/E04-task-mgmt-cli-core/E04-F05-folder-management/02-architecture.md#91-unit-tests) for specific test cases.

**Performance**:
- Folder creation completes in <100ms
- Path mapping operations complete in <1ms

**Type Safety**:
- All functions properly typed with pathlib.Path
- mypy passes with no errors

## Context & Resources

- **Architecture**: [Folder Structure](../../../docs/plan/E04-task-mgmt-cli-core/E04-F05-folder-management/02-architecture.md#32-folder-structure)
- **PRD**: [Folder Structure Management](../../../docs/plan/E04-task-mgmt-cli-core/E04-F05-folder-management/prd.md#folder-structure-management)
- **ADR-001**: [Blocked Tasks Get Their Own Folder](../../../docs/plan/E04-task-mgmt-cli-core/E04-F05-folder-management/02-architecture.md#adr-001-blocked-tasks-get-their-own-folder)

## Notes for Agent

- **Idempotency Critical**: Folder creation must work even if some/all folders already exist
- **pathlib.Path**: Always use pathlib for path operations - never string concatenation or os.path.join
- **Status Mapping**: Blocked status maps to `blocked/` folder (ADR-001) - this is a key architectural decision
- **Error Messages**: Include full paths in error messages for debugging
- **No File Operations**: This task only creates folders and provides path utilities - no file moving yet
