
---
key: T-E07-F01-001
title: Add GetByFilePath and UpdateFilePath methods to Epic and Feature repositories
epic: E07
feature: E07-F01
agent: backend
status: todo
priority: 1
created_at: 2025-12-18T04:54:03Z
---

# Task: Repository Methods for Custom Filenames

## Goal

Add repository methods for collision detection and file path management to both `EpicRepository` and `FeatureRepository`. Also add database indexes for performance.

**Reference**: See `/home/jwwelbor/projects/shark-task-manager/dev-artifacts/2025-12-18-custom-filename-feature/PROGRESS.md` for task implementation pattern (Phase 1).

## Requirements

### Functional Requirements

- [ ] Add `GetByFilePath(ctx context.Context, filePath string) (*models.Epic, error)` to EpicRepository
- [ ] Add `GetByFilePath(ctx context.Context, filePath string) (*models.Feature, error)` to FeatureRepository
- [ ] Add `UpdateFilePath(ctx context.Context, epicKey string, newFilePath *string) error` to EpicRepository
- [ ] Add `UpdateFilePath(ctx context.Context, featureKey string, newFilePath *string) error` to FeatureRepository
- [ ] Methods return sql.ErrNoRows when file not found (for collision detection)
- [ ] Methods accept nil to clear file_path (for force reassignment)
- [ ] Use parameterized queries to prevent SQL injection

### Non-Functional Requirements

- [ ] Queries complete in < 100ms (collision detection performance)
- [ ] Database indexes added: `idx_epics_file_path`, `idx_features_file_path`

## Implementation Plan

### Files to Modify

1. **internal/repository/epic_repository.go**
   - Add GetByFilePath method (similar to TaskRepository:170-211)
   - Add UpdateFilePath method (similar to TaskRepository:213-237)

2. **internal/repository/feature_repository.go**
   - Add GetByFilePath method (mirror of epic version)
   - Add UpdateFilePath method (mirror of epic version)

3. **internal/db/db.go**
   - Add index on epics.file_path column
   - Add index on features.file_path column

### Steps

1. [ ] Review TaskRepository methods in internal/repository/task_repository.go:170-237
2. [ ] Implement GetByFilePath for EpicRepository
3. [ ] Implement UpdateFilePath for EpicRepository
4. [ ] Implement GetByFilePath for FeatureRepository
5. [ ] Implement UpdateFilePath for FeatureRepository
6. [ ] Add database indexes in internal/db/db.go (after line 159)
7. [ ] Run tests: `make test`

## Deliverables

- [ ] GetByFilePath method for epics
- [ ] UpdateFilePath method for epics
- [ ] GetByFilePath method for features
- [ ] UpdateFilePath method for features
- [ ] Database indexes for both tables
- [ ] Code compiles without errors

## Acceptance Criteria

- [ ] Methods follow existing TaskRepository patterns
- [ ] Parameterized queries used for security
- [ ] Methods handle NULL values correctly
- [ ] Indexes exist on file_path columns
- [ ] All tests pass
- [ ] Code review approved

## Testing Strategy

- [ ] Unit tests in epic_repository_test.go
- [ ] Unit tests in feature_repository_test.go
- [ ] Test GetByFilePath with existing and non-existing paths
- [ ] Test UpdateFilePath with valid paths and NULL
- [ ] Verify index performance with EXPLAIN

## Dependencies

No blocking dependencies. Phase 1 of epic/feature custom filename implementation.
