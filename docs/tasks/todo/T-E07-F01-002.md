
---
key: T-E07-F01-002
title: Extract ValidateCustomFilename to shared validation module
epic: E07
feature: E07-F01
agent: backend
status: todo
priority: 2
created_at: 2025-12-18T04:54:03Z
---

# Task: Shared Filename Validation Logic

## Goal

Extract `ValidateCustomFilename` from task creator to a shared module so it can be reused by epic, feature, and task creators without code duplication.

**Reference**: See `/home/jwwelbor/projects/shark-task-manager/dev-artifacts/2025-12-18-custom-filename-feature/PROGRESS.md` Phase 2 and internal/taskcreation/creator.go:229-273 for reference implementation.

## Requirements

### Functional Requirements

- [ ] Move ValidateCustomFilename from creator.go to internal/taskcreation/validation.go
- [ ] Function accepts filename, projectRoot, and returns (absPath, relPath, error)
- [ ] Validates relative paths only (rejects absolute paths)
- [ ] Prevents path traversal (rejects `..`)
- [ ] Requires `.md` extension
- [ ] Validates within project boundaries
- [ ] Returns both absolute path (for file ops) and relative path (for database storage)

### Non-Functional Requirements

- [ ] Zero code duplication across task, epic, feature creators
- [ ] Comprehensive error messages for each validation failure

## Implementation Plan

### Files to Modify

1. **internal/taskcreation/validation.go** (NEW FILE)
   - Create new file with shared validation functions
   - Add ValidateCustomFilename function with all validation logic

2. **internal/taskcreation/creator.go**
   - Update to import and use ValidateCustomFilename from validation.go
   - Remove duplicate validation logic

3. **internal/taskcreation/epic_creator.go** or equivalent
   - Will use ValidateCustomFilename in upcoming tasks

4. **internal/taskcreation/feature_creator.go** or equivalent
   - Will use ValidateCustomFilename in upcoming tasks

### Steps

1. [ ] Review current ValidateCustomFilename in creator.go:229-273
2. [ ] Create internal/taskcreation/validation.go
3. [ ] Move ValidateCustomFilename to validation.go with full documentation
4. [ ] Update creator.go to import from validation.go
5. [ ] Verify task creator still works: `make test`
6. [ ] Update imports in all files that will use the function

## Deliverables

- [ ] validation.go file created with ValidateCustomFilename
- [ ] Task creator updated to use shared validation
- [ ] No duplicate validation code in codebase
- [ ] All tests pass
- [ ] Function fully documented with examples

## Acceptance Criteria

- [ ] ValidateCustomFilename available in shared module
- [ ] Task creator uses shared function and still passes all tests
- [ ] All validation rules enforced consistently
- [ ] Error messages clear and actionable
- [ ] Code review approved

## Testing Strategy

- [ ] Comprehensive unit tests in validation_test.go covering:
  - [ ] Valid relative paths (simple, nested, with dots)
  - [ ] Absolute path rejection
  - [ ] Path traversal prevention
  - [ ] Wrong extension rejection
  - [ ] Path normalization
  - [ ] Special characters and case preservation
  - [ ] Boundary conditions

## Dependencies

Depends on: Task T-E07-F01-001 (repository methods should be in place first)

