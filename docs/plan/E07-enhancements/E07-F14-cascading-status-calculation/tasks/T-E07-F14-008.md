---
agent: backend
created_at: 2026-01-01T19:35:37Z
depends_on:
    - T-E07-F14-004
    - T-E07-F14-006
epic: E07
feature: E07-F14
key: T-E07-F14-008
priority: 6
related-docs:
    - docs/plan/E07-enhancements/E07-F14-cascading-status-calculation/prd.md
    - docs/plan/E07-enhancements/E07-F14-cascading-status-calculation/status-calculation-rules.md
status: todo
task_key: T-E07-F14-020
title: Add --status=auto flag to feature and epic update commands
---

# Task: Add --status=auto flag to feature and epic update commands

## Goal

Enable users to clear manual status override and return to automatic status calculation by using `--status=auto` flag on feature and epic update commands.

## Requirements

### Functional Requirements

- [ ] `shark feature update <key> --status=auto` clears override
- [ ] `shark epic update <key> --status=auto` clears override (if implemented)
- [ ] After clearing override, status is immediately recalculated
- [ ] Regular `--status=<value>` sets override to true

### Non-Functional Requirements

- [ ] Clear user feedback on status change
- [ ] JSON output includes status_source field
- [ ] Backward compatible with existing --status behavior

## Implementation Plan

### Steps

1. [ ] Modify feature update command to handle "auto" value
2. [ ] When status=auto: clear override and recalculate
3. [ ] When status=other: set override and apply status
4. [ ] Update JSON output to include status source
5. [ ] Add CLI tests for new behavior

### Technical Approach

Location: `internal/cli/commands/feature.go`

```go
var featureUpdateCmd = &cobra.Command{
    Use:   "update <key>",
    Short: "Update a feature",
    RunE: func(cmd *cobra.Command, args []string) error {
        statusFlag, _ := cmd.Flags().GetString("status")

        if statusFlag == "auto" {
            // Clear override
            err := featureRepo.SetStatusOverride(ctx, feature.ID, false)
            if err != nil {
                return fmt.Errorf("failed to clear override: %w", err)
            }

            // Recalculate status
            result, err := calcService.RecalculateFeatureStatus(ctx, feature.ID)
            if err != nil {
                return fmt.Errorf("failed to recalculate: %w", err)
            }

            cli.Success("Feature %s status recalculated: %s", feature.Key, result.NewStatus)
        } else if statusFlag != "" {
            // Manual override
            err := featureRepo.SetStatusOverride(ctx, feature.ID, true)
            err = featureRepo.UpdateStatus(ctx, feature.ID, models.FeatureStatus(statusFlag))

            cli.Success("Feature %s status set to: %s (manual override)", feature.Key, statusFlag)
        }

        return nil
    },
}
```

## Deliverables

- [ ] Updated feature update command
- [ ] Updated epic update command (if applicable)
- [ ] CLI tests for --status=auto behavior

## Acceptance Criteria

- [ ] `--status=auto` clears override and recalculates
- [ ] `--status=blocked` sets override and applies status
- [ ] Clear output message indicating calculated vs override
- [ ] JSON output includes `status_source` field
- [ ] Validation rejects invalid status values

## Testing Strategy

```go
func TestFeatureUpdate_StatusAuto(t *testing.T) {
    // Create feature with manual override
    // Run `feature update --status=auto`
    // Verify override cleared
    // Verify status recalculated from tasks
}

func TestFeatureUpdate_StatusManual(t *testing.T) {
    // Create feature with auto status
    // Run `feature update --status=blocked`
    // Verify override set to true
    // Verify status is "blocked"
}
```

## Dependencies

- T-E07-F14-004: SetStatusOverride method
- T-E07-F14-006: RecalculateFeatureStatus method

## Notes

- "auto" is a special value, not a valid FeatureStatus
- Consider adding completion for valid status values
- See PRD Story 3 for acceptance criteria
