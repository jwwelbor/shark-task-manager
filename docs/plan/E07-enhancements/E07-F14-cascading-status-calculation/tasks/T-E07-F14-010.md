---
agent: qa
created_at: 2026-01-01T19:35:37Z
depends_on:
    - T-E07-F14-002
epic: E07
feature: E07-F14
key: T-E07-F14-010
priority: 5
related-docs:
    - docs/plan/E07-enhancements/E07-F14-cascading-status-calculation/test-plan.md
    - docs/plan/E07-enhancements/E07-F14-cascading-status-calculation/status-calculation-rules.md
status: todo
task_key: T-E07-F14-022
title: Add unit tests for status derivation algorithms
---

# Task: Add unit tests for status derivation algorithms

## Goal

Create comprehensive unit tests for the status derivation functions to ensure all edge cases are handled correctly per the specification.

## Requirements

### Functional Requirements

- [ ] Test deriveFeatureStatus with all task status combinations
- [ ] Test deriveEpicStatus with all feature status combinations
- [ ] Cover edge cases: empty, all same status, mixed statuses
- [ ] Table-driven tests for maintainability

### Non-Functional Requirements

- [ ] 100% code coverage on derivation.go
- [ ] Tests run in < 100ms (no database)
- [ ] Clear test case names describing scenario

## Implementation Plan

### Steps

1. [ ] Create derivation_test.go with TestDeriveFeatureStatus
2. [ ] Add all test cases from test-plan.md section 2.1
3. [ ] Create TestDeriveEpicStatus with all cases
4. [ ] Run coverage and ensure 100%
5. [ ] Document any discovered edge cases

### Technical Approach

Location: `internal/status/derivation_test.go`

```go
func TestDeriveFeatureStatus(t *testing.T) {
    tests := []struct {
        name     string
        counts   map[models.TaskStatus]int
        expected models.FeatureStatus
    }{
        // Empty
        {"empty_returns_draft", map[models.TaskStatus]int{}, models.FeatureStatusDraft},

        // All same status
        {"all_todo_returns_draft", map[models.TaskStatus]int{models.TaskStatusTodo: 5}, models.FeatureStatusDraft},
        {"all_completed_returns_completed", map[models.TaskStatus]int{models.TaskStatusCompleted: 5}, models.FeatureStatusCompleted},
        {"all_archived_returns_completed", map[models.TaskStatus]int{models.TaskStatusArchived: 3}, models.FeatureStatusCompleted},
        {"all_in_progress_returns_active", map[models.TaskStatus]int{models.TaskStatusInProgress: 2}, models.FeatureStatusActive},
        {"all_blocked_returns_active", map[models.TaskStatus]int{models.TaskStatusBlocked: 2}, models.FeatureStatusActive},

        // Mixed statuses
        {"any_in_progress_returns_active", map[models.TaskStatus]int{
            models.TaskStatusTodo: 2, models.TaskStatusInProgress: 1, models.TaskStatusCompleted: 3,
        }, models.FeatureStatusActive},
        {"any_ready_for_review_returns_active", map[models.TaskStatus]int{
            models.TaskStatusTodo: 2, models.TaskStatusReadyForReview: 1,
        }, models.FeatureStatusActive},
        {"blocked_with_todo_returns_active", map[models.TaskStatus]int{
            models.TaskStatusTodo: 3, models.TaskStatusBlocked: 1,
        }, models.FeatureStatusActive},
        {"mixed_completed_archived_returns_completed", map[models.TaskStatus]int{
            models.TaskStatusCompleted: 3, models.TaskStatusArchived: 2,
        }, models.FeatureStatusCompleted},
        {"todo_and_completed_returns_active", map[models.TaskStatus]int{
            models.TaskStatusTodo: 2, models.TaskStatusCompleted: 3,
        }, models.FeatureStatusActive},
    }

    for _, tt := range tests {
        t.Run(tt.name, func(t *testing.T) {
            result := deriveFeatureStatus(tt.counts)
            assert.Equal(t, tt.expected, result)
        })
    }
}
```

## Deliverables

- [ ] `internal/status/derivation_test.go`
- [ ] 100% coverage report

## Acceptance Criteria

- [ ] All test cases from test-plan.md section 2.1 implemented
- [ ] Tests pass with `go test ./internal/status/...`
- [ ] Coverage >= 100% on derivation.go
- [ ] No database or external dependencies in tests

## Testing Strategy

Run tests:

```bash
go test -v ./internal/status/... -run TestDerive
go test -cover ./internal/status/...
```

Test matrix from status-calculation-rules.md:

| Task Composition | Expected Status |
|------------------|-----------------|
| Empty | draft |
| All todo | draft |
| Any in_progress | active |
| Any ready_for_review | active |
| All blocked | active |
| All completed | completed |
| All archived | completed |
| Mix completed + archived | completed |
| Mix todo + completed | active |

## Dependencies

- T-E07-F14-002: Derivation functions must exist

## Notes

- These are pure unit tests with no mocks needed
- Use testify/assert for cleaner assertions
- See test-plan.md for complete test specifications
