---
agent: backend
created_at: 2026-01-01T19:35:37Z
epic: E07
feature: E07-F14
key: T-E07-F14-001
priority: 9
related-docs:
    - docs/plan/E07-enhancements/E07-F14-cascading-status-calculation/data-models.md
    - docs/plan/E07-enhancements/E07-F14-cascading-status-calculation/prd.md
status: todo
task_key: T-E07-F14-013
title: Add status_override column migration to features table
---

# Task: Add status_override column migration to features table

## Goal

Add a `status_override` boolean column to the features table that allows manual status control, bypassing automatic calculation from child tasks.

## Requirements

### Functional Requirements

- [ ] Add `status_override BOOLEAN DEFAULT 0` column to features table
- [ ] Create index `idx_features_status_override` for efficient queries
- [ ] Migration runs automatically in `runMigrations()`
- [ ] Migration is idempotent (safe to run multiple times)
- [ ] Existing features get `status_override = 0` (auto-calculation)

### Non-Functional Requirements

- [ ] Migration completes in < 100ms for databases with 1000+ features
- [ ] No data loss during migration
- [ ] Backward compatible with existing queries

## Implementation Plan

### Steps

1. [ ] Add migration check in `internal/db/db.go` `runMigrations()`
2. [ ] Check if column exists using `pragma_table_info`
3. [ ] Add column with `ALTER TABLE features ADD COLUMN status_override BOOLEAN DEFAULT 0`
4. [ ] Create index with `CREATE INDEX IF NOT EXISTS idx_features_status_override ON features(status_override)`
5. [ ] Test migration on empty and populated databases

### Technical Approach

Location: `internal/db/db.go`

```go
// Check if features table has status_override column
err = db.QueryRow(`
    SELECT COUNT(*) FROM pragma_table_info('features') WHERE name = 'status_override'
`).Scan(&columnExists)

if columnExists == 0 {
    _, err = db.Exec(`ALTER TABLE features ADD COLUMN status_override BOOLEAN DEFAULT 0;`)
    _, err = db.Exec(`CREATE INDEX IF NOT EXISTS idx_features_status_override ON features(status_override);`)
}
```

## Deliverables

- [ ] Migration code in `internal/db/db.go`
- [ ] Migration test in `internal/db/migration_status_override_test.go`

## Acceptance Criteria

- [ ] Column exists after running any shark command
- [ ] Index exists on status_override column
- [ ] Existing features have status_override = 0
- [ ] Migration is safe to run multiple times
- [ ] All existing tests pass

## Testing Strategy

- [ ] Unit test: Migration adds column when missing
- [ ] Unit test: Migration is idempotent
- [ ] Unit test: Existing data preserved
- [ ] Integration test: Column accessible via repository

## Dependencies

No dependencies - this is the foundation task.

## Notes

- SQLite doesn't support DROP COLUMN easily, so no rollback script
- Column defaults to 0 (false) so existing behavior unchanged
- See `data-models.md` for schema details
