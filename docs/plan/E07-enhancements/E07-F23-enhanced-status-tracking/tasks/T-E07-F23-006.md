---
key: T-E07-F23-006
title: Add Repository Methods for Status Info
epic: E07
feature: E07-F23
agent: backend
status: todo
priority: 4
depends_on: ["T-E07-F23-002", "T-E07-F23-003"]
created_at: 2026-01-16T19:55:54Z
---

# Task: Add Repository Methods for Status Info

**Estimated Effort:** 2.5 hours
**Phase:** 2 - Repository Enhancements

---

## Goal

Add `GetStatusInfo()` to FeatureRepository and rollup methods to EpicRepository. These methods fetch comprehensive status data efficiently.

---

## Files to Modify

**`internal/repository/feature_repository.go`:**
- Add `taskRepo *TaskRepository` field
- Update constructor: `NewFeatureRepository(db *DB, taskRepo *TaskRepository)`
- Add method: `GetStatusInfo(ctx context.Context, featureID int64) (*FeatureStatusInfo, error)`

**`internal/repository/epic_repository.go`:**
- Add method: `GetFeatureStatusRollup(ctx context.Context, epicID int64) (map[string]int, error)`
- Add method: `GetTaskStatusRollup(ctx context.Context, epicID int64) (map[string]int, error)`

**SQL Queries:**
```sql
-- Feature status rollup
SELECT status, COUNT(*) as count FROM features WHERE epic_id = ? GROUP BY status;

-- Task status rollup (across epic)
SELECT t.status, COUNT(*) as count FROM tasks t
JOIN features f ON t.feature_id = f.id
WHERE f.epic_id = ? GROUP BY t.status;
```

---

## Acceptance Criteria

- [ ] FeatureRepository has TaskRepository dependency
- [ ] GetStatusInfo() returns complete FeatureStatusInfo
- [ ] GetFeatureStatusRollup() efficient GROUP BY query
- [ ] GetTaskStatusRollup() efficient JOIN + GROUP BY query
- [ ] Repository tests pass with real database
- [ ] All queries use existing indexes

---

## Testing

Create `internal/repository/feature_repository_test.go`:
- TestGetStatusInfo (with seeded data)
- TestGetStatusInfo_EmptyFeature
- TestGetFeatureStatusRollup
- TestGetTaskStatusRollup

---

## Related Documentation

- Architecture: `architecture.md` (Section 3 - Repository Layer)
- Implementation Plan: `implementation-plan.md` (Tasks E07-F23-004, E07-F23-005)
