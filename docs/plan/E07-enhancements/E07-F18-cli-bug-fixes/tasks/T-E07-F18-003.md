
---
key: T-E07-F18-003
title: Make task next-status non-interactive by default
epic: E07
feature: E07-F18
agent: backend
status: todo
priority: 5
created_at: 2026-01-16T22:46:18Z
---

# Task: Make task next-status non-interactive by default

## Goal

Make the `shark task next-status` command non-interactive by default to support agent/automation workflows. Only use interactive mode when explicitly enabled via configuration.

## Problem Statement

Currently, when a task status has multiple valid transitions, the `next-status` command prompts the user to select which transition to take. This breaks automation and agent workflows because:

1. Agents can't provide interactive input to background processes
2. Commands hang waiting for user selection
3. Forces agents to use the more verbose `task update --status` command instead

**Example of current behavior:**
```
$ ./bin/shark task next-status T-E07-F23-006
Task: T-E07-F23-006
Current status: ready_for_qa

Available transitions:
  1) in_qa
  2) on_hold

Enter selection [1-2] or Ctrl+C to cancel: ▊
```

## Proposed Solution

**Default behavior (non-interactive):**
- When multiple transitions available, automatically select the first transition defined in workflow config
- Print which status was selected (for transparency)
- Exit with status 0 on success

**Optional interactive mode:**
- Add config setting: `interactive_mode: true` in `.sharkconfig.json`
- Only prompt for selection when this setting is enabled
- Default value: `false` (non-interactive)

## Implementation Details

### 1. Configuration Schema

Add to `.sharkconfig.json`:
```json
{
  "interactive_mode": false,  // Default: non-interactive
  "workflow": {
    // ... existing workflow config
  }
}
```

### 2. Code Changes

**File:** `internal/cli/commands/task_status.go` (or wherever `next-status` is implemented)

**Current logic:**
```go
// Get valid transitions
transitions := workflowSvc.GetValidTransitions(currentStatus)

if len(transitions) > 1 {
    // CURRENT: Always prompt for selection
    selected := promptUserSelection(transitions)
    newStatus = selected
}
```

**New logic:**
```go
// Get valid transitions
transitions := workflowSvc.GetValidTransitions(currentStatus)

if len(transitions) > 1 {
    // Check if interactive mode enabled
    if cfg.InteractiveMode {
        // Interactive: prompt user
        selected := promptUserSelection(transitions)
        newStatus = selected
    } else {
        // Non-interactive: auto-select first transition
        newStatus = transitions[0]
        cli.Info(fmt.Sprintf("Auto-selected next status: %s (from %d options)", newStatus, len(transitions)))
    }
} else if len(transitions) == 1 {
    // Only one option: auto-select
    newStatus = transitions[0]
}
```

### 3. Workflow Config Order

The order of transitions in workflow config determines priority:

```json
{
  "status_flow": {
    "ready_for_qa": ["in_qa", "on_hold"]  // First = default
  }
}
```

In this example, `in_qa` would be auto-selected as the default next status.

### 4. User Experience

**Non-interactive (default):**
```bash
$ ./bin/shark task next-status T-E07-F23-006
ℹ Auto-selected next status: in_qa (from 2 options)
✅ Task T-E07-F23-006 transitioned: ready_for_qa → in_qa
```

**Interactive mode (when enabled):**
```bash
$ ./bin/shark task next-status T-E07-F23-006
Task: T-E07-F23-006
Current status: ready_for_qa

Available transitions:
  1) in_qa
  2) on_hold

Enter selection [1-2]: 1
✅ Task T-E07-F23-006 transitioned: ready_for_qa → in_qa
```

## Acceptance Criteria

- [ ] Config setting `interactive_mode` added to `.sharkconfig.json` schema
- [ ] Default value is `false` (non-interactive)
- [ ] When `interactive_mode=false`, first transition is auto-selected
- [ ] Clear message printed showing which status was auto-selected
- [ ] When `interactive_mode=true`, existing prompt behavior works
- [ ] Works with all workflow statuses that have multiple transitions
- [ ] Single-transition statuses still auto-select (no change)
- [ ] Exit code 0 on success, non-zero on failure
- [ ] JSON output works: `shark task next-status <task> --json`

## Testing Requirements

### Unit Tests

**File:** `internal/cli/commands/task_status_test.go`

Test cases:
- [ ] `TestNextStatus_NonInteractive_MultipleOptions` - Auto-selects first
- [ ] `TestNextStatus_Interactive_MultipleOptions` - Prompts user
- [ ] `TestNextStatus_SingleOption` - Auto-selects regardless of mode
- [ ] `TestNextStatus_NoValidTransitions` - Returns error
- [ ] `TestNextStatus_ConfigDefault` - Defaults to non-interactive
- [ ] `TestNextStatus_JSONOutput` - JSON format works

### Integration Tests

- [ ] Test with real workflow config (multiple transitions)
- [ ] Test config loading and parsing
- [ ] Test backward compatibility (works without config setting)

### Manual Testing

```bash
# Test 1: Non-interactive (default)
./bin/shark task next-status T-E07-F23-006
# Expected: Auto-selects first option, prints info message

# Test 2: Interactive mode
# Edit .sharkconfig.json: "interactive_mode": true
./bin/shark task next-status T-E07-F23-006
# Expected: Prompts for selection

# Test 3: JSON output
./bin/shark task next-status T-E07-F23-006 --json
# Expected: Valid JSON response with new status
```

## Related Files

- `internal/cli/commands/task_status.go` - Main implementation
- `internal/config/config.go` - Config schema for `interactive_mode`
- `internal/config/manager.go` - Config loading
- `.sharkconfig.json` - Add `interactive_mode` field
- `docs/CLI_REFERENCE.md` - Document new behavior

## Migration Notes

**Backward compatibility:**
- If `interactive_mode` not present in config, default to `false` (non-interactive)
- Existing behavior preserved when `interactive_mode: true` is set
- No breaking changes for manual users (they can enable interactive mode)
- Agents and automation get better default behavior

## Priority Justification

**Priority 5 (Medium):**
- Improves agent/automation experience significantly
- Non-breaking change with backward compatibility
- Relatively small implementation scope
- Not blocking current functionality (workaround exists: use `task update --status`)

## Estimated Complexity

**Size:** Small (S)
- ~50 lines of code changes
- Simple config schema addition
- Straightforward logic modification
- Well-defined test cases

**Effort:** 2-3 hours
- 30min: Config schema and loading
- 1 hour: Command logic update
- 1 hour: Tests and documentation
- 30min: Manual testing and verification
