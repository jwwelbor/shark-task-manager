---
task_key: T-E07-F24-001
feature_key: E07-F24
title: "Phase 1: Create data structures and profile registry"
status: todo
agent: backend
priority: 8
estimated_hours: 2-3
dependencies: []
related_docs:
  - ../technical-design.md
  - ../specifications/business-requirements.md
---

# Task: Phase 1 - Data Structures & Profile Registry

**Feature**: E07-F24 - Workflow Profile Support
**Phase**: 1 of 6
**Estimated Time**: 2-3 hours

## Objective

Create the foundational data structures and profile registry for workflow profile support, including type definitions and the two predefined profiles (basic and advanced).

## Files to Create

1. `internal/init/types.go`
   - Define `WorkflowProfile` struct
   - Define `StatusMetadata` struct
   - Define `UpdateOptions` struct
   - Define `UpdateResult` struct
   - Define `ChangeReport` struct

2. `internal/init/profiles.go`
   - Implement `ProfileRegistry`
   - Define `basicProfile` constant
   - Define `advancedProfile` constant
   - Implement `GetProfile(name string) (*WorkflowProfile, error)`
   - Implement `ListProfiles() []string`

3. `internal/init/profiles_test.go`
   - Test profile retrieval (basic, advanced, invalid)
   - Test profile structure validation
   - Test ListProfiles() output

## Implementation Plan

### Step 1: Create Data Structures (`types.go`)

```go
type WorkflowProfile struct {
    Name            string
    Description     string
    StatusMetadata  map[string]StatusMetadata
    StatusFlow      map[string][]string
    SpecialStatuses map[string][]string
}

type StatusMetadata struct {
    Color          string
    Description    string
    Phase          string
    AgentTypes     []string
    ProgressWeight float64
    Responsibility string
    BlocksFeature  bool
}

type UpdateOptions struct {
    ProfileName string
    Force       bool
    DryRun      bool
}

type UpdateResult struct {
    ProfileApplied  string
    ChangesDetected ChangeReport
    Success         bool
}

type ChangeReport struct {
    StatusesAdded    []string
    StatusesModified []string
    StatusesRemoved  []string
    FieldsPreserved  []string
}
```

### Step 2: Create Profile Constants (`profiles.go`)

Define two profile constants:

**Basic Profile** (5 statuses):
- todo (gray, planning, 0.0, none)
- in_progress (blue, development, 0.5, agent)
- ready_for_review (yellow, review, 0.9, human, blocks=true)
- completed (green, done, 1.0, none)
- blocked (red, any, 0.0, none, blocks=true)

**Advanced Profile** (19 statuses):
- draft, ready_for_refinement_ba, in_refinement_ba
- ready_for_refinement_tech, in_refinement_tech
- ready_for_development, in_development
- ready_for_code_review, in_code_review, changes_requested
- ready_for_qa, in_qa, qa_failed
- ready_for_approval, in_approval
- completed, blocked, cancelled, on_hold

Full status definitions in: `../technical-design.md#phase-1`

### Step 3: Implement Profile Registry

```go
func GetProfile(name string) (*WorkflowProfile, error) {
    switch strings.ToLower(name) {
    case "basic":
        return basicProfile, nil
    case "advanced":
        return advancedProfile, nil
    default:
        return nil, fmt.Errorf("unknown profile: %s", name)
    }
}

func ListProfiles() []string {
    return []string{"basic", "advanced"}
}
```

### Step 4: Write Unit Tests

Test coverage targets: >95%

Tests to implement:
- `TestGetProfile_Basic` - Retrieves basic profile successfully
- `TestGetProfile_Advanced` - Retrieves advanced profile successfully
- `TestGetProfile_Invalid` - Returns error for unknown profile
- `TestGetProfile_CaseInsensitive` - Handles "BASIC", "Basic", etc.
- `TestListProfiles` - Returns exactly 2 profiles
- `TestBasicProfile_Structure` - Validates basic profile has 5 statuses
- `TestAdvancedProfile_Structure` - Validates advanced profile has 19 statuses

## Acceptance Criteria

- [x] **AC1**: `GetProfile("basic")` returns valid basic profile with 5 statuses
- [x] **AC2**: `GetProfile("advanced")` returns valid advanced profile with 19 statuses
- [x] **AC3**: `GetProfile("invalid")` returns descriptive error
- [x] **AC4**: Profile names are case-insensitive
- [x] **AC5**: `ListProfiles()` returns ["basic", "advanced"]
- [x] **AC6**: All data structures compile without errors
- [x] **AC7**: Unit tests achieve >95% coverage
- [x] **AC8**: All tests pass

## Test Plan

### Unit Tests

```bash
# Run tests
go test -v ./internal/init -run TestGetProfile
go test -v ./internal/init -run TestListProfiles

# Check coverage
go test -cover ./internal/init -run "TestGetProfile|TestListProfiles"
```

### Manual Verification

```go
// Verify basic profile structure
profile, _ := GetProfile("basic")
fmt.Printf("Statuses: %d\n", len(profile.StatusMetadata)) // Should be 5

// Verify advanced profile structure
profile, _ := GetProfile("advanced")
fmt.Printf("Statuses: %d\n", len(profile.StatusMetadata)) // Should be 19
```

## Dependencies

**Requires**:
- None (first phase, no dependencies)

**Blocks**:
- T-E07-F24-002 (Phase 2: Config Merger needs profile structures)
- T-E07-F24-003 (Phase 3: Profile Service needs profiles)

## Design References

- **Technical Design**: Section "Phase 1: Data Structures & Profile Registry" (lines 1050-1071)
- **Profile Definitions**: Section "Appendix A: Profile Definitions"
- **Data Structures**: Section "Data Structures" (lines 200-400)

## Success Indicators

✅ Code compiles without errors
✅ All unit tests pass
✅ Coverage >95%
✅ Profile retrieval works for both profiles
✅ Error handling works for invalid profiles
✅ No hardcoded magic strings (use constants)

## Notes

- Keep profiles as Go constants (not external files) for simplicity
- Use `strings.ToLower()` for case-insensitive profile names
- Basic profile should match current default shark workflow
- Advanced profile uses the full 19-status workflow from user requirements
- Ensure `ProgressWeight` is float64 between 0.0 and 1.0

## Estimated Breakdown

- Data structures: 30 min
- Basic profile definition: 30 min
- Advanced profile definition: 45 min
- Profile registry: 15 min
- Unit tests: 30-45 min
- **Total**: 2-3 hours
