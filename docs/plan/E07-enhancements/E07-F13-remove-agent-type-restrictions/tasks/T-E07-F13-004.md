---
agent: backend
created_at: 2026-01-01T06:56:44Z
epic: E07
feature: E07-F13
key: T-E07-F13-004
priority: 7
status: todo
task_key: T-E07-F13-010
title: Verify task creation validator works with custom agent types
---


# Task: Verify task creation validator works with custom agent types

## Goal

Verify that the task creation validator (`internal/taskcreation/validator.go`) correctly accepts custom agent types after the agent type restrictions have been removed. This task ensures that multi-agent workflows can successfully create tasks for specialized agent roles beyond the original six hardcoded values.

## Context

The validator is called during task creation flow to validate all input fields before task creation. After removing agent type restrictions in `internal/models/validation.go`, we need to verify that:

1. The validator's `ValidateTaskInput()` method accepts custom agent types
2. Custom agent types are properly converted to `models.AgentType`
3. Task creation succeeds with custom agent types
4. The created task stores and retrieves the custom agent type correctly

**Code Location**: `internal/taskcreation/validator.go`, specifically lines 73-84 which handle agent type validation.

## Test Scenarios

### Scenario 1: Standard Agent Types (Backward Compatibility)
**Purpose**: Ensure existing functionality remains intact

**Test Cases**:
- `frontend` - Should work (original hardcoded type)
- `backend` - Should work (original hardcoded type)
- `api` - Should work (original hardcoded type)
- `testing` - Should work (original hardcoded type)
- `devops` - Should work (original hardcoded type)
- `general` - Should work (original hardcoded type)

**Expected Behavior**:
- All standard agent types pass validation
- No breaking changes to existing tasks
- Task created successfully with agent_type stored in database

### Scenario 2: Multi-Agent Workflow Custom Types
**Purpose**: Validate new custom agent types for orchestration workflows

**Test Cases**:
- `architect` - AI agent that designs system architecture
- `business-analyst` - AI agent that writes requirements
- `product-manager` - AI agent that creates PRDs and manages workflow
- `qa` - AI agent that performs quality assurance
- `tech-lead` - AI agent that coordinates technical decisions
- `ux-designer` - AI agent that designs user interfaces
- `data-engineer` - Specialized engineer for data pipelines
- `ml-engineer` - Machine learning specialist
- `security-analyst` - Security specialist

**Expected Behavior**:
- All custom agent types pass validation
- Task created successfully with custom agent_type
- Agent type stored exactly as provided (case-sensitive)
- Can retrieve task and agent_type matches input

### Scenario 3: Specialized Team Roles
**Purpose**: Validate domain-specific custom agent types

**Test Cases**:
- `database-admin` - Database administration specialist
- `cloud-architect` - Cloud infrastructure specialist
- `mobile-developer` - Mobile platform specialist
- `accessibility-expert` - Accessibility compliance specialist
- `performance-engineer` - Performance optimization specialist
- `documentation-writer` - Technical documentation specialist

**Expected Behavior**:
- All specialized roles pass validation
- Hyphenated agent types handled correctly
- No restrictions on naming conventions

### Scenario 4: Edge Cases
**Purpose**: Test boundary conditions and invalid inputs

**Test Cases**:
- Empty string `""` - Should use default (`general`)
- Single character `"a"` - Should work (any non-empty string valid)
- Very long name `"very-long-custom-agent-type-name-that-exceeds-normal-length"` - Should work
- Special characters `"agent@type"` - Should work (no character restrictions)
- Numbers `"agent123"` - Should work
- Mixed case `"BackEnd-Engineer"` - Should work (case-sensitive)
- Whitespace only `"   "` - Should trim and default to `general` OR reject

**Expected Behavior**:
- Empty string defaults to `general`
- Any non-empty string accepted (no character restrictions)
- Whitespace-only should be handled gracefully

### Scenario 5: Integration with Full Task Creation Flow
**Purpose**: Verify end-to-end task creation with custom agent types

**Test Flow**:
1. Create epic and feature (standard workflow)
2. Create task with custom agent type: `shark task create E07 F13 "Test custom agent" --agent=architect`
3. Verify task created in database
4. Retrieve task: `shark task get T-E07-F13-XXX --json`
5. Verify agent_type field contains `architect`
6. Create second task with different custom type: `--agent=business-analyst`
7. List tasks filtered by agent: `shark task list --agent=architect`

**Expected Behavior**:
- Task creation succeeds via CLI
- Database stores custom agent type correctly
- JSON output includes agent_type field
- Task listing/filtering works with custom agent types

## Validation Requirements

### Code Review Checkpoints
- [ ] Validator calls `models.ValidateAgentType()` which now accepts any non-empty string
- [ ] No hardcoded agent type checks remain in validator
- [ ] Default to `general` when agent type is empty/not provided
- [ ] Agent type conversion to `models.AgentType` works correctly

### Testing Checkpoints
- [ ] Unit tests added for custom agent types in `validator_test.go`
- [ ] Integration test verifies end-to-end task creation
- [ ] Test coverage includes all scenarios above
- [ ] Tests verify database storage and retrieval

## Acceptance Criteria

### Must Have
- [ ] Validator accepts all custom agent types (architect, business-analyst, qa, etc.)
- [ ] Standard agent types (frontend, backend, etc.) continue working (backward compatibility)
- [ ] Empty agent type defaults to `general`
- [ ] Task creation flow completes successfully with custom agent types
- [ ] Database stores custom agent_type values correctly
- [ ] Task retrieval returns correct agent_type value

### Should Have
- [ ] Unit tests cover custom agent type validation
- [ ] Integration tests verify end-to-end flow
- [ ] Error messages are helpful if validation fails
- [ ] Documentation updated with examples of custom agent types

### Nice to Have
- [ ] CLI help text mentions custom agent types are supported
- [ ] Examples in documentation show multi-agent workflow usage

## Success Criteria

**Primary**:
- Can create tasks with custom agent types: `architect`, `business-analyst`, `product-manager`, `qa`, etc.
- Validator does not reject custom agent types
- Task created successfully stores agent_type in database

**Secondary**:
- All standard agent types still work (no breaking changes)
- Edge cases handled gracefully (empty string, special characters, etc.)
- Integration tests pass for full task creation flow

## Test Execution Plan

### Phase 1: Validator Unit Tests
1. Review existing tests in `internal/taskcreation/validator_test.go`
2. Add test cases for custom agent types
3. Verify `ValidateTaskInput()` accepts custom types
4. Run tests: `go test -v ./internal/taskcreation -run TestValidateTaskInput`

### Phase 2: Integration Tests
1. Create test epic/feature
2. Create tasks with custom agent types via validator
3. Verify database storage
4. Verify task retrieval
5. Run tests: `go test -v ./internal/taskcreation -run TestIntegration`

### Phase 3: Manual CLI Verification
1. Create task: `./bin/shark task create E07 F13 "Test architect" --agent=architect`
2. Get task: `./bin/shark task get T-E07-F13-XXX --json`
3. Verify agent_type in JSON output
4. Repeat with different custom types

## Related Code

**Key Files**:
- `internal/taskcreation/validator.go` - Main validator being tested (lines 73-84)
- `internal/models/validation.go` - `ValidateAgentType()` function (lines 161-176)
- `internal/taskcreation/validator_test.go` - Test file for validator
- `internal/models/task.go` - AgentType type definition

**Test Dependencies**:
- Depends on T-E07-F13-001 (Update ValidateAgentType to accept any non-empty string)
- Depends on T-E07-F13-002 (Remove validation from Task.Validate)

## Notes

**Important**:
- This is a VERIFICATION task, not an implementation task
- The actual changes to remove restrictions happen in T-E07-F13-001 and T-E07-F13-002
- Focus is on creating comprehensive test cases and verifying behavior
- Tests should be added to existing test files, not new implementation code

**Testing Focus**:
- Positive cases: custom agent types work
- Negative cases: edge cases handled gracefully
- Backward compatibility: standard types still work
- Integration: full task creation flow succeeds
