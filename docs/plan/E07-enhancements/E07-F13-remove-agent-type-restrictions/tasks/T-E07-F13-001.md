---
agent: backend
created_at: 2026-01-01T06:56:40Z
epic: E07
feature: E07-F13
key: T-E07-F13-001
priority: 8
status: todo
task_key: T-E07-F13-007
title: Update ValidateAgentType to accept any non-empty string
related-docs:
  - internal/models/validation.go
  - internal/taskcreation/validator.go
  - internal/models/task.go
  - internal/templates/renderer.go
---


# Task: Update ValidateAgentType to accept any non-empty string

## Goal

Remove hardcoded agent type restrictions to allow flexible agent type values while maintaining basic validation for non-empty strings. This enables users to specify custom agent types without being constrained to a predefined list (frontend, backend, api, testing, devops, general).

## Current Behavior

The ValidateAgentType function currently restricts agent types to exactly 6 values:
- frontend
- backend
- api
- testing
- devops
- general

**Location:** `internal/models/validation.go` (lines 161-176)
**Also duplicated in:** `internal/taskcreation/validator.go` (lines 173-182)

## Desired Behavior

ValidateAgentType should accept **any non-empty, trimmed string** with the following constraints:

### Valid Agent Types
- Any string with **at least 1 character after trimming**
- Examples: "backend", "frontend-react", "ml-engineer", "data-scientist", "custom-agent-123"

### Invalid Agent Types (Must Reject)
- Empty string: `""`
- Whitespace-only: `"   "`, `"\t"`, `"\n"`
- Strings that become empty after trimming: `"  \t  \n  "`

### Maximum Length (Recommended)
- Maximum 100 characters (prevents abuse)
- Rationale: Keeps agent type values reasonable and prevents storage issues

### Character Restrictions (Optional - For Discussion)
**Option A (Permissive):** Accept any Unicode characters
**Option B (Restrictive):** Accept only alphanumeric, hyphens, underscores: `^[a-zA-Z0-9_-]+$`
**Option C (Moderate):** Accept alphanumeric plus common separators (spaces, hyphens, underscores)

**Recommendation:** Start with Option A (permissive) - validate only non-empty/trimmed, no character restrictions

## Implementation Specifications

### Function Signature Changes

**File:** `internal/models/validation.go`

```go
// ValidateAgentType validates the agent type
// Accepts any non-empty string after trimming whitespace
// Maximum length: 100 characters
func ValidateAgentType(agentType string) error {
    trimmed := strings.TrimSpace(agentType)

    if trimmed == "" {
        return fmt.Errorf("agent type cannot be empty or whitespace-only")
    }

    if len(trimmed) > 100 {
        return fmt.Errorf("agent type too long: maximum 100 characters, got %d", len(trimmed))
    }

    return nil
}
```

### Files to Update

1. **`internal/models/validation.go`** (lines 161-176)
   - Update ValidateAgentType function
   - Remove hardcoded map of valid types
   - Implement trimming + length validation
   - Update error message

2. **`internal/taskcreation/validator.go`** (lines 173-182)
   - **REMOVE duplicate ValidateAgentType function**
   - Use `models.ValidateAgentType` instead (already called at line 77)
   - This eliminates code duplication

3. **Error Constant** in `internal/models/validation.go` (line 19)
   - Update `ErrInvalidAgentType` error message:
   ```go
   ErrInvalidAgentType = errors.New("invalid agent type: cannot be empty or whitespace-only")
   ```

### Error Messages

**Empty/Whitespace-only:**
```
"agent type cannot be empty or whitespace-only"
```

**Too Long:**
```
"agent type too long: maximum 100 characters, got 150"
```

## Acceptance Criteria

### Core Functionality
- [ ] ValidateAgentType accepts any non-empty trimmed string
- [ ] ValidateAgentType rejects empty string (`""`)
- [ ] ValidateAgentType rejects whitespace-only strings (`"   "`, `"\t"`, `"\n"`)
- [ ] ValidateAgentType enforces maximum length of 100 characters
- [ ] ValidateAgentType trims input before validation

### Backward Compatibility
- [ ] Existing valid agent types still pass: "frontend", "backend", "api", "testing", "devops", "general"
- [ ] Custom agent types now pass: "frontend-react", "ml-engineer", "data-scientist"
- [ ] All existing calls to ValidateAgentType continue to work

### Code Quality
- [ ] Duplicate ValidateAgentType in `taskcreation/validator.go` is removed
- [ ] All usages point to `models.ValidateAgentType`
- [ ] Error messages are clear and actionable
- [ ] Function has proper documentation comment

## Testing Requirements

### Unit Tests to Add

**File:** `internal/models/validation_test.go` (create if doesn't exist)

```go
func TestValidateAgentType(t *testing.T) {
    tests := []struct {
        name      string
        agentType string
        wantErr   bool
        errContains string
    }{
        // Valid cases
        {"backend", "backend", false, ""},
        {"frontend", "frontend", false, ""},
        {"custom agent", "frontend-react", false, ""},
        {"with spaces", "ml engineer", false, ""},
        {"with numbers", "agent-123", false, ""},
        {"unicode", "エージェント", false, ""},
        {"trimmed spaces", "  backend  ", false, ""},

        // Invalid cases
        {"empty string", "", true, "cannot be empty"},
        {"whitespace only spaces", "   ", true, "cannot be empty"},
        {"whitespace only tabs", "\t\t\t", true, "cannot be empty"},
        {"whitespace only newlines", "\n\n", true, "cannot be empty"},
        {"whitespace mixed", "  \t\n  ", true, "cannot be empty"},
        {"too long", strings.Repeat("a", 101), true, "too long"},
        {"exactly 100 chars", strings.Repeat("a", 100), false, ""},
        {"101 chars", strings.Repeat("a", 101), true, "maximum 100 characters"},
    }

    for _, tt := range tests {
        t.Run(tt.name, func(t *testing.T) {
            err := ValidateAgentType(tt.agentType)
            if tt.wantErr {
                require.Error(t, err)
                if tt.errContains != "" {
                    assert.Contains(t, err.Error(), tt.errContains)
                }
            } else {
                require.NoError(t, err)
            }
        })
    }
}
```

### Tests to Update

**File:** `internal/taskcreation/validator_test.go`

1. **Remove:** `TestValidateAgentType` function (lines 490-517)
   - Duplicate of models package test
   - No longer needed after removing duplicate function

2. **Update:** `TestValidator_ValidateTaskInput_InvalidAgentType` (lines 141-171)
   - Change test to use whitespace-only string instead of "invalid-agent"
   - Update expected error message to match new validation

3. **Update:** `TestValidator_ValidateTaskInput_AllAgentTypes` (lines 173-207)
   - Add custom agent types: "frontend-react", "ml-engineer", "custom-123"
   - Remove test for uppercase (should now be valid)

### Integration Tests

- [ ] Test task creation with custom agent types via CLI
- [ ] Test task creation with empty/whitespace agent types fails appropriately
- [ ] Test task creation with very long agent types fails appropriately

## Edge Cases to Consider

### Trimming Behavior
- Input: `"  backend  "` → Trimmed: `"backend"` → **Valid**
- Input: `"  "` → Trimmed: `""` → **Invalid** (empty after trim)

### Length Validation
- 100 characters exactly → **Valid**
- 101 characters → **Invalid**
- Length check applies AFTER trimming

### Special Characters
- Hyphens: `"frontend-react"` → **Valid**
- Underscores: `"ml_engineer"` → **Valid**
- Spaces: `"ML Engineer"` → **Valid**
- Numbers: `"agent-123"` → **Valid**
- Unicode: `"エージェント"` → **Valid**

### Case Sensitivity
- `"Backend"` → **Valid** (case preserved)
- `"FRONTEND"` → **Valid** (case preserved)
- No case normalization applied

## Files Affected

### Primary Changes
- `internal/models/validation.go` - Update ValidateAgentType function
- `internal/taskcreation/validator.go` - Remove duplicate function
- `internal/models/validation_test.go` - Add comprehensive tests (create if needed)
- `internal/taskcreation/validator_test.go` - Update existing tests

### Files That Call ValidateAgentType (No Changes Needed)
- `internal/models/task.go` (line 97) - Validation still works
- `internal/templates/renderer.go` (line 41) - Validation still works
- `internal/taskcreation/validator.go` (line 77) - Already uses models.ValidateAgentType

## Implementation Notes

### Order of Operations
1. Update `models.ValidateAgentType` with new logic
2. Update error constant in `models/validation.go`
3. Remove duplicate function from `taskcreation/validator.go`
4. Add comprehensive unit tests
5. Update existing tests that expect old behavior
6. Run full test suite to verify no regressions

### Backward Compatibility
All existing valid agent types remain valid:
- "frontend", "backend", "api", "testing", "devops", "general"

New capability: custom agent types now accepted

### Performance Considerations
- Trimming operation: O(n) where n = string length
- Length check: O(1)
- No regex matching needed (unless character restrictions added later)

## Security Considerations

### SQL Injection
- Agent type is stored as text in database
- All database access uses parameterized queries
- No SQL injection risk

### Storage Concerns
- 100-character limit prevents excessive storage use
- Database column type: TEXT (can accommodate)

### Display Concerns
- Long agent types may affect UI layout
- Consider UI truncation for display purposes (separate concern)

## Future Enhancements (Out of Scope)

These are NOT part of this task but could be considered later:

1. **Character Restrictions:** Add regex validation for allowed characters
2. **Reserved Keywords:** Prevent certain reserved words (if needed)
3. **Normalization:** Auto-lowercase or auto-trim agent types
4. **Predefined Suggestions:** UI could suggest common types while allowing custom
5. **Agent Type Registry:** Track which agent types are actually used

## Migration Notes

No database migration needed - this is a validation-only change.

Existing tasks with the 6 predefined agent types will continue to work without modification.

## Documentation Updates Needed

After implementation:
- [ ] Update CLI help text for `--agent` flag (if it mentions valid types)
- [ ] Update API documentation (if applicable)
- [ ] Update user-facing documentation about agent types
