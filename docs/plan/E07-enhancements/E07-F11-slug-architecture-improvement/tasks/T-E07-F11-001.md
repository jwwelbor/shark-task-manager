
---
key: T-E07-F11-001
title: Add slug columns to database schema
epic: E07
feature: E07-F11
agent: backend
status: todo
priority: 10
created_at: 2025-12-30T06:59:40Z
---

# Task: Add slug columns to database schema

## Goal

Add slug columns to epics, features, and tasks tables to store slugs as database fields instead of computing them on-the-fly. This is the foundation for making the database the single source of truth for all metadata.

## User Story

**Story ID**: S-1-1
**Priority**: P0 - MUST HAVE
**Phase**: 1 - Database Schema

As a system architect, I want slug columns added to epics, features, and tasks tables so that slugs can be stored as database fields instead of being computed on-the-fly.

## Database Schema Changes

### Tables to Modify

```sql
-- Epics table
ALTER TABLE epics ADD COLUMN slug TEXT;
CREATE INDEX idx_epics_slug ON epics(slug);

-- Features table
ALTER TABLE features ADD COLUMN slug TEXT;
CREATE INDEX idx_features_slug ON features(slug);

-- Tasks table
ALTER TABLE tasks ADD COLUMN slug TEXT;
CREATE INDEX idx_tasks_slug ON tasks(slug);
```

### Migration Requirements

- [ ] Columns are nullable (to support existing records)
- [ ] Indexes created for performance
- [ ] Migration is idempotent (can run multiple times safely)
- [ ] Schema verification after migration

## Acceptance Criteria

### AC1: Slug Columns Added
- [ ] slug column added to epics table (TEXT, nullable)
- [ ] slug column added to features table (TEXT, nullable)
- [ ] slug column added to tasks table (TEXT, nullable)

### AC2: Indexes Created
- [ ] Index idx_epics_slug created on epics(slug)
- [ ] Index idx_features_slug created on features(slug)
- [ ] Index idx_tasks_slug created on tasks(slug)

### AC3: Migration is Idempotent
- [ ] Migration can run multiple times without errors
- [ ] Columns are not duplicated
- [ ] Indexes are not duplicated
- [ ] IF NOT EXISTS checks in place

### AC4: Schema Verification
- [ ] Can query database schema to see slug columns
- [ ] Can query database schema to see indexes
- [ ] All three tables have slug column

## Implementation Details

### Files to Modify

- `internal/db/db.go` - Add migration logic to InitDB()
- Create new migration function or update schema creation

### Migration Strategy

1. Check if slug column exists (SELECT sql FROM sqlite_master)
2. If not exists, add column with ALTER TABLE
3. Create index if not exists
4. Repeat for all three tables
5. Log success/skip message

## Testing Requirements

### Integration Tests

- [ ] Migration runs successfully on fresh database
- [ ] Migration runs successfully on existing database (idempotent)
- [ ] Schema verification queries succeed
- [ ] Indexes exist and are functional

## Related Documentation

- Architecture Analysis: `/home/jwwelbor/projects/shark-task-manager/dev-artifacts/2025-12-30-slug-architecture-review/architectural-analysis.md`
- User Stories: `/home/jwwelbor/projects/shark-task-manager/docs/plan/E07-enhancements/E07-F11-slug-architecture-improvement/user-stories.md`

## Notes

- This is P0 work - foundation for all other slug architecture work
- Must complete before T-E07-F11-002 (backfill) can start
- Low risk: nullable columns, backward compatible
