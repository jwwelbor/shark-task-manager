
---
key: T-E07-F11-002
title: Backfill slugs from existing file paths
epic: E07
feature: E07-F11
agent: backend
status: todo
priority: 10
depends_on: ["T-E07-F11-001"]
created_at: 2025-12-30T06:59:47Z
---

# Task: Backfill slugs from existing file paths

## Goal

Extract slugs from existing file_path values and populate the slug column for all existing epics, features, and tasks. This backfill ensures existing entities have slugs without requiring manual data entry.

## User Story

**Story ID**: S-1-2
**Priority**: P0 - MUST HAVE
**Phase**: 1 - Database Schema

As a database administrator, I want existing slugs extracted from file_path and stored in the slug column so that existing epics/features/tasks have slugs without requiring manual data entry.

## Slug Extraction Logic

### Epic Slug Extraction
Given: `file_path = "docs/plan/E05-task-mgmt-cli-capabilities/epic.md"`
Extract: `slug = "task-mgmt-cli-capabilities"`

Pattern: Extract text between `E##-` and `/epic.md`

### Feature Slug Extraction
Given: `file_path = "docs/plan/E06-intelligent-scanning/E06-F04-incremental-sync-engine/prd.md"`
Extract: `slug = "incremental-sync-engine"`

Pattern: Extract text after last `F##-` and before `/prd.md`

### Task Slug Extraction
Given: `file_path = "docs/plan/E04-epic/E04-F01-feature/tasks/T-E04-F01-001-some-task-description.md"`
Extract: `slug = "some-task-description"`

Pattern: Extract text after task key (`T-E##-F##-###-`) and before `.md`

## Acceptance Criteria

### AC1: Epic Slug Extraction
- [ ] Epics with file_path have slugs extracted correctly
- [ ] Slug matches pattern: text between E##- and /epic.md
- [ ] Example: E05-task-mgmt → "task-mgmt"

### AC2: Feature Slug Extraction
- [ ] Features with file_path have slugs extracted correctly
- [ ] Slug matches pattern: text after F##- and before /prd.md
- [ ] Example: E06-F04-incremental-sync → "incremental-sync"

### AC3: Task Slug Extraction
- [ ] Tasks with file_path have slugs extracted correctly
- [ ] Slug matches pattern: text after task key before .md
- [ ] Example: T-E04-F01-001-fix-bug → "fix-bug"

### AC4: NULL Handling
- [ ] Entities with NULL file_path keep slug as NULL
- [ ] Entities with empty file_path keep slug as NULL
- [ ] No errors occur for missing file_path

### AC5: Verification Report
- [ ] Count of epics with slugs extracted
- [ ] Count of features with slugs extracted
- [ ] Count of tasks with slugs extracted
- [ ] Count of entities with NULL slugs
- [ ] Summary shows coverage percentage

## Implementation Details

### SQL Strategy

Use UPDATE statements with string manipulation:

```sql
-- Epics
UPDATE epics
SET slug = substr(file_path, instr(file_path, '-') + 1, instr(file_path, '/epic.md') - instr(file_path, '-') - 1)
WHERE file_path IS NOT NULL AND file_path != '';

-- Features
UPDATE features
SET slug = substr(file_path, ...pattern logic...)
WHERE file_path IS NOT NULL AND file_path != '';

-- Tasks
UPDATE tasks
SET slug = substr(file_path, ...pattern logic...)
WHERE file_path IS NOT NULL AND file_path != '';
```

### Go Implementation Strategy

Alternative: Read all entities, extract slugs in Go, update database:
- More readable logic
- Better error handling
- Easier to test

## Testing Requirements

### Integration Tests

- [ ] Backfill script runs successfully
- [ ] All entities with file_path get slugs
- [ ] Entities without file_path remain NULL
- [ ] Verification report shows expected counts
- [ ] No data loss or corruption

## Related Documentation

- User Stories: Story S-1-2
- Architecture Review: Slug extraction patterns

## Notes

- Depends on T-E07-F11-001 (slug columns must exist)
- This is a one-time migration for existing data
- New entities will store slugs at creation time (Phase 2)
