---
agent: backend
created_at: 2025-12-30T07:00:16Z
depends_on:
    - T-E07-F11-007
epic: E07
feature: E07-F11
key: T-E07-F11-008
priority: 8
related-docs:
    - docs/plan/E07-enhancements/E07-F11-slug-architecture-improvement/feature-overview.md
    - dev-artifacts/2025-12-30-slug-architecture-review/implementation-examples.md
    - internal/utils/path_builder.go
status: todo
task_key: T-E07-F11-026
title: Implement PathResolver interface with database-first design
---


# Task: Implement PathResolver interface with database-first design

## Goal

Create a new PathResolver that reads entity metadata (keys, slugs, custom paths) from the database instead of computing them from file paths or titles. This replaces PathBuilder's file-system-first approach with a database-first design.

**Key Improvement**: Path resolution should query the database once (0.1ms) instead of reading files and computing slugs (1ms), achieving 10x performance improvement.

## Implementation Specification

### New File to Create: `internal/pathresolver/resolver.go`

Implement a PathResolver struct with these methods:

```go
type PathResolver struct {
    epicRepo    *repository.EpicRepository
    featureRepo *repository.FeatureRepository
    taskRepo    *repository.TaskRepository
    projectRoot string
}

func NewPathResolver(...) *PathResolver
func (pr *PathResolver) ResolveEpicPath(ctx context.Context, epicKey string) (string, error)
func (pr *PathResolver) ResolveFeaturePath(ctx context.Context, featureKey string) (string, error)
func (pr *PathResolver) ResolveTaskPath(ctx context.Context, taskKey string) (string, error)
```

### Implementation Steps

1. **Create `internal/pathresolver/` package**
2. **Implement ResolveEpicPath**:
   - Query epic by key from database (gets slug, custom_folder_path, filename)
   - Build path using precedence: filename > custom_folder_path > default
   - Return absolute path
3. **Implement ResolveFeaturePath**:
   - Query feature and its parent epic from database
   - Inherit custom_folder_path from epic if feature doesn't have one
   - Build path using precedence: filename > custom_folder_path > default
4. **Implement ResolveTaskPath**:
   - Query task, feature, and epic from database
   - Use feature's path as base directory
   - Return task file path

### Key Differences from PathBuilder

**PathBuilder (OLD - file-based)**:
- Takes parameters: `ResolveEpicPath(epicKey, filename, customFolderPath)`
- Computes slug from title if needed
- No database access
- Stateless path computation

**PathResolver (NEW - database-first)**:
- Takes only key: `ResolveEpicPath(ctx, epicKey)`
- Reads all metadata from database
- Single database query per resolution
- Database is source of truth

### Acceptance Criteria

- [ ] PathResolver struct created in `internal/pathresolver/resolver.go`
- [ ] Constructor `NewPathResolver` accepts repository dependencies
- [ ] `ResolveEpicPath` queries database and builds correct path
- [ ] `ResolveFeaturePath` queries database and inherits parent path correctly
- [ ] `ResolveTaskPath` queries database and uses feature base path
- [ ] Custom folder paths respected (filename > custom_folder_path > default)
- [ ] Error handling for missing entities (return descriptive errors)
- [ ] Unit tests for all three path resolution methods
- [ ] Performance: Each method completes in <1ms (target: 0.1ms)

## Testing Requirements

### Unit Tests

Create `internal/pathresolver/resolver_test.go`:

- [ ] Test ResolveEpicPath with default path
- [ ] Test ResolveEpicPath with custom folder path
- [ ] Test ResolveEpicPath with explicit filename
- [ ] Test ResolveFeaturePath with inherited epic path
- [ ] Test ResolveFeaturePath with feature override path
- [ ] Test ResolveTaskPath with default feature path
- [ ] Test error handling for non-existent keys
- [ ] Test path precedence order (filename > custom > default)

### Integration Tests

- [ ] Real database query integration
- [ ] Verify paths match actual file locations
- [ ] Performance benchmark (<1ms per call)

## Reference Materials

**See these files for context**:
- `docs/plan/E07-enhancements/E07-F11-slug-architecture-improvement/feature-overview.md` - Full feature specification
- `dev-artifacts/2025-12-30-slug-architecture-review/implementation-examples.md` - Code examples and patterns
- `internal/utils/path_builder.go` - Current implementation to replace
- `internal/repository/epic_repository.go` - Example database queries

**Code Example** (from implementation-examples.md):
See PathResolver implementation section for complete working example.

## Notes

- PathResolver is injected with repositories (dependency injection pattern)
- Each resolution requires database query - optimize queries to fetch all needed data in one call
- Use context.Context for database operations (supports cancellation/timeouts)
- PathBuilder will be deprecated after this is integrated (see T-E07-F11-015)
- Follow existing repository patterns for error handling and logging
