---
task_key: T-E07-F09-005
epic_key: E07
feature_key: E07-F09
title: Integration Testing and Documentation
status: todo
priority: 7
agent_type: testing
depends_on:
  - T-E07-F09-004
---

# Task: Integration Testing and Documentation

## Goal

Create comprehensive integration tests for custom folder paths feature and update all user-facing documentation with examples, usage patterns, and migration guides.

## Success Criteria

- [ ] End-to-end integration tests for all user stories pass
- [ ] Sync integration tests verify discovery and conflict resolution
- [ ] Path inheritance tests cover all precedence scenarios
- [ ] CLI reference documentation updated with --path flag
- [ ] CLAUDE.md updated with custom folder path examples
- [ ] Migration guide created for existing installations
- [ ] README.md mentions organizational flexibility (if applicable)
- [ ] Command help text includes examples and clear descriptions
- [ ] All test scenarios from PRD Section 5 covered

## Implementation Guidance

### Integration Tests to Write

**Reference**: `prd.md` Section 5.2 "Integration Tests" and Section 5.3 "End-to-End Scenarios"

#### Epic Creation Tests

**File**: `internal/cli/commands/epic_test.go`

Test scenarios:
- `TestEpicCreate_WithCustomPath`: Epic created with --path flag, file at correct location
- `TestEpicCreate_WithInvalidPath`: Invalid paths rejected with clear errors
- `TestEpicCreate_WithFilenameAndPath`: --filename takes precedence over --path
- `TestEpicCreate_Default`: No --path uses default location
- `TestEpicCreate_CustomPath_StoresInDB`: Verify custom_folder_path saved to database

#### Feature Creation Tests

**File**: `internal/cli/commands/feature_test.go`

Test scenarios:
- `TestFeatureCreate_InheritsEpicCustomPath`: Feature uses epic's custom path
- `TestFeatureCreate_OverridesEpicCustomPath`: Feature --path overrides epic
- `TestFeatureCreate_WithCustomPath_NoEpicPath`: Feature custom path only
- `TestFeatureCreate_WithFilename`: --filename overrides all paths
- `TestFeatureCreate_Default`: No custom paths → default location
- `TestFeatureCreate_CustomPath_StoresInDB`: Verify custom_folder_path saved

#### Task Creation Tests

**File**: `internal/cli/commands/task_test.go`

Test scenarios:
- `TestTaskCreate_InheritsFeatureCustomPath`: Task uses feature's custom path
- `TestTaskCreate_InheritsEpicCustomPath`: Task uses epic's custom path (no feature path)
- `TestTaskCreate_WithFilename`: --filename overrides inherited paths
- `TestTaskCreate_Default`: No custom paths → default location
- `TestTaskCreate_FeaturePathOverridesEpicPath`: Correct precedence

#### Sync Integration Tests

**File**: `internal/sync/sync_test.go` or similar

Test scenarios (from PRD Section 4 Phase 4):
- `TestSync_DiscoverEpicWithCustomPath`: Discover epic with custom_folder_path in frontmatter
- `TestSync_DiscoverFeatureInheritingEpicPath`: Feature inherits epic's custom path
- `TestSync_DiscoverFeatureWithOwnCustomPath`: Feature overrides epic's custom path
- `TestSync_DiscoverTasksInCustomPaths`: Tasks discovered in custom locations
- `TestSync_ConflictResolution_CustomPath`: Handle file vs DB custom_folder_path conflicts
- `TestSync_MovedFiles`: Handle files moved to custom locations

### End-to-End Test Scenarios

**Reference**: `prd.md` Section 5.3 "End-to-End Scenarios"

Implement the 4 scenarios from the PRD:
1. **Scenario 1**: Epic with Custom Path Hierarchy
2. **Scenario 2**: Feature Overrides Epic Path
3. **Scenario 3**: Task Filename Overrides All
4. **Scenario 4**: Sync with Custom Paths

Each scenario should be an integration test that:
- Creates entities via CLI commands
- Verifies files created at expected paths
- Checks database has correct custom_folder_path values
- Tests path inheritance and precedence

### Documentation Updates

#### CLI Reference

**File to Update**: `docs/CLI_REFERENCE.md`

**What to Add**:
- `--path` flag documentation for `epic create`
- `--path` flag documentation for `feature create`
- Examples of custom folder path usage
- Explanation of path inheritance rules
- Precedence order: filename > custom_folder_path > parent custom path > default

**Reference**: `prd.md` Section 3.1 "CLI Interface"

#### CLAUDE.md Updates

**File to Update**: `CLAUDE.md`

**What to Add**:
- New command syntax: `shark epic create --path=...`
- New command syntax: `shark feature create --path=...`
- Examples from PRD Appendix A
- Path resolution rules
- Database schema changes (new columns)
- Migration instructions for existing installations

**Reference**: `prd.md` Appendix A "Command Examples"

#### Migration Guide

**File to Create**: `docs/MIGRATION_CUSTOM_PATHS.md` (or section in existing migration doc)

**What to Include**:
- SQL migration script for existing databases
- Steps to add custom_folder_path columns
- Index creation commands
- Testing migration success
- Rollback procedure (if needed)

**Reference**: `03-data-design.md` Section "Migration Strategy"

**Migration SQL**:
```sql
-- Add custom_folder_path column to epics
ALTER TABLE epics ADD COLUMN custom_folder_path TEXT;

-- Add custom_folder_path column to features
ALTER TABLE features ADD COLUMN custom_folder_path TEXT;

-- Create indexes
CREATE INDEX IF NOT EXISTS idx_epics_custom_folder_path ON epics(custom_folder_path);
CREATE INDEX IF NOT EXISTS idx_features_custom_folder_path ON features(custom_folder_path);
```

#### README Updates

**File to Update**: `README.md`

**What to Add** (if applicable):
- Mention organizational flexibility in feature list
- Link to CLI reference for custom folder paths
- Brief example of custom path usage

### Command Help Text

**Files to Update**:
- `internal/cli/commands/epic.go` (epic create help text)
- `internal/cli/commands/feature.go` (feature create help text)

**What to Add**:
Examples in help text for --path flag (from PRD Section 3.1)

## Validation Gates

- [ ] Run all integration tests: `make test` passes
- [ ] Manual test: Follow each end-to-end scenario from PRD Section 5.3
- [ ] Manual test: Create epic with custom path, verify file location
- [ ] Manual test: Feature inherits epic path correctly
- [ ] Manual test: Invalid paths rejected with clear errors
- [ ] Manual test: Sync discovers custom paths correctly
- [ ] Documentation review: All new flags documented
- [ ] Documentation review: Examples accurate and tested
- [ ] Migration guide tested on existing database
- [ ] Verify backward compatibility: default-path items still work

## Context & Resources

**Design Documents**:
- Test requirements: `docs/plan/E07-enhancements/E07-F09-custom-folder-base-paths/prd.md` (Section 5)
- End-to-end scenarios: `docs/plan/E07-enhancements/E07-F09-custom-folder-base-paths/prd.md` (Section 5.3)
- Success criteria: `docs/plan/E07-enhancements/E07-F09-custom-folder-base-paths/prd.md` (Section 6)
- Migration strategy: `docs/plan/E07-enhancements/E07-F09-custom-folder-base-paths/03-data-design.md`

**Codebase References**:
- Existing test patterns: `internal/cli/commands/*_test.go`
- Sync tests: `internal/sync/*_test.go`
- Documentation: `docs/CLI_REFERENCE.md`, `CLAUDE.md`, `README.md`

**Test Coverage Target**:
- Unit tests: >90% coverage for PathBuilder and validators
- Integration tests: 100% coverage of user stories (PRD Section 2)
- End-to-end tests: All 4 scenarios from PRD Section 5.3

## Notes for Agent

**Testing Best Practices**:
- Use table-driven tests for path resolution scenarios
- Test both happy path and error cases
- Verify database state after operations (not just file existence)
- Test backward compatibility (NULL custom_folder_path works)

**Documentation Best Practices**:
- Examples should be copy-pasteable and accurate
- Include "why" context, not just "how"
- Cross-reference related features (e.g., --filename from E07-F08)
- Migration guide should be step-by-step with verification steps

**Edge Cases to Test**:
- Empty string vs NULL (should both be NULL)
- Trailing slashes normalized
- Absolute paths rejected
- Path traversal (`..`) rejected
- Paths outside project rejected
- Multiple entities in same custom folder (valid)

**Success Metrics**:
- All user stories from PRD Section 2 have passing tests
- All success criteria from PRD Section 6 are met
- Documentation clear enough for users to self-serve
- Migration guide tested on real existing database
