
---
key: T-E07-F21-012
title: Implement workflow show-actions command
epic: E07
feature: E07-F21
agent: backend
status: todo
priority: 6
depends_on: ["T-E07-F21-001"]
created_at: 2026-01-15T01:52:59Z
---

# Task: Implement workflow show-actions command

## Goal

Implement `shark workflow show-actions` command to display all orchestrator actions defined in the workflow configuration. This provides a comprehensive overview of the agent flow, showing which agents are triggered for each status transition, helping workflow configuration managers understand and document the complete workflow.

**User Story**: Story 6 - As a workflow configuration manager, I want to view all orchestrator actions in my workflow so that I can understand the complete agent flow.

**Value**: Provides self-documentation for workflows, making it easy to visualize which agents handle which statuses and what actions occur at each transition.

## Command Specification

### Command Syntax

```bash
shark workflow show-actions [--json] [--status=<status>] [--action-type=<type>]
```

### Flags

- `--json`: Output in JSON format for programmatic access
- `--status <status>`: Filter to show action for specific status (optional)
- `--action-type <type>`: Filter by action type (`spawn_agent`, `pause`, `wait_for_triage`, `archive`)

### Output Format

**Human-Readable (Default)**:

Display actions grouped by workflow phase in a table format:

```
Workflow Orchestrator Actions
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

Planning Phase:
┌────────────────────────────┬──────────────┬────────────────────┬─────────────────────┐
│ Status                     │ Action       │ Agent Type         │ Skills              │
├────────────────────────────┼──────────────┼────────────────────┼─────────────────────┤
│ ready_for_refinement_ba    │ spawn_agent  │ business-analyst   │ specification-writ… │
│ ready_for_refinement_tech  │ spawn_agent  │ architect          │ architecture, desi… │
└────────────────────────────┴──────────────┴────────────────────┴─────────────────────┘

Development Phase:
┌────────────────────────────┬──────────────┬────────────────────┬─────────────────────┐
│ Status                     │ Action       │ Agent Type         │ Skills              │
├────────────────────────────┼──────────────┼────────────────────┼─────────────────────┤
│ ready_for_development      │ spawn_agent  │ developer          │ test-driven-develo… │
└────────────────────────────┴──────────────┴────────────────────┴─────────────────────┘

Review Phase:
┌────────────────────────────┬──────────────┬────────────────────┬─────────────────────┐
│ Status                     │ Action       │ Agent Type         │ Skills              │
├────────────────────────────┼──────────────┼────────────────────┼─────────────────────┤
│ ready_for_code_review      │ spawn_agent  │ code-reviewer      │ quality, code-revi… │
└────────────────────────────┴──────────────┴────────────────────┴─────────────────────┘

Special States:
┌────────────────────────────┬──────────────┬────────────────────┬─────────────────────┐
│ Status                     │ Action       │ Agent Type         │ Skills              │
├────────────────────────────┼──────────────┼────────────────────┼─────────────────────┤
│ blocked                    │ pause        │ -                  │ -                   │
│ completed                  │ archive      │ -                  │ -                   │
└────────────────────────────┴──────────────┴────────────────────┴─────────────────────┘

Summary:
  Total Statuses: 15
  With Actions: 12
  spawn_agent: 10
  pause: 1
  archive: 1
  wait_for_triage: 0
```

**JSON Format** (`--json` flag):

```json
{
  "workflow_actions": [
    {
      "status": "ready_for_refinement_ba",
      "phase": "planning",
      "color": "cyan",
      "orchestrator_action": {
        "action": "spawn_agent",
        "agent_type": "business-analyst",
        "skills": ["specification-writing", "shark-task-management", "research"],
        "instruction_template": "Launch a business-analyst agent to refine requirements for task {task_id}. Review task description and user stories. Document clear acceptance criteria and ensure requirements are testable."
      }
    },
    {
      "status": "ready_for_development",
      "phase": "development",
      "color": "yellow",
      "orchestrator_action": {
        "action": "spawn_agent",
        "agent_type": "developer",
        "skills": ["test-driven-development", "implementation", "shark-task-management"],
        "instruction_template": "Launch a developer agent to implement task {task_id}. Write tests first, then implement to pass tests following the technical specifications."
      }
    },
    {
      "status": "blocked",
      "phase": "any",
      "color": "red",
      "orchestrator_action": {
        "action": "pause",
        "instruction_template": "Task {task_id} is blocked. Do not spawn agent. Blocker reason documented in task notes."
      }
    },
    {
      "status": "completed",
      "phase": "done",
      "color": "green",
      "orchestrator_action": {
        "action": "archive",
        "instruction_template": "Task {task_id} is completed. No further action needed."
      }
    }
  ],
  "summary": {
    "total_statuses": 15,
    "statuses_with_actions": 12,
    "action_counts": {
      "spawn_agent": 10,
      "pause": 1,
      "wait_for_triage": 0,
      "archive": 1
    }
  }
}
```

## Implementation Details

### Phase Ordering

Display statuses grouped by workflow phase in this order:

1. **planning** - Draft, refinement stages (cyan, gray colors)
2. **development** - Active implementation (yellow colors)
3. **review** - Code review stages (magenta colors)
4. **qa** - Quality assurance (green colors)
5. **approval** - Final approval stages (purple colors)
6. **done** - Terminal states (white/green colors)
7. **any** - Statuses applicable to any phase (blocked, on_hold) - shown as "Special States"

### Configuration Loading

- Load workflow configuration from `.sharkconfig.json`
- Read `status_metadata` for all defined statuses
- Extract `orchestrator_action` from each status metadata
- Group statuses by their `phase` field

### Data Processing

1. Iterate through all statuses in `status_metadata`
2. For each status:
   - Extract phase, color, orchestrator_action
   - If `orchestrator_action` is defined, include in output
   - If `orchestrator_action` is missing, omit from display (or show as "-")
3. Group by phase using phase ordering above
4. Calculate summary statistics

### Table Display

- Use `cli.OutputTable()` for human-readable format
- Truncate long skill lists with "..." if needed (e.g., "specification-writ…")
- Show "-" for missing agent_type/skills when action is not `spawn_agent`
- Color-code status names using `status_metadata.color` if `--no-color` not set

### Filtering

**By Status** (`--status` flag):
- Show only the action for the specified status
- Display full instruction template (not truncated)
- Exit with code 1 if status not found

**By Action Type** (`--action-type` flag):
- Filter to show only statuses with matching action type
- Useful for finding all "spawn_agent" statuses or all "pause" statuses

## Command Implementation Checklist

- [ ] Create command file `internal/cli/commands/workflow_show_actions.go`
- [ ] Register command with root: `shark workflow show-actions`
- [ ] Load workflow config from `.sharkconfig.json`
- [ ] Parse `status_metadata` and extract orchestrator actions
- [ ] Group statuses by workflow phase
- [ ] Implement human-readable table output (grouped by phase)
- [ ] Implement JSON output format
- [ ] Add `--status` filter flag
- [ ] Add `--action-type` filter flag
- [ ] Calculate summary statistics (total, counts by action type)
- [ ] Handle missing orchestrator_action gracefully (show as empty or "-")
- [ ] Add command to `shark workflow` subcommand group
- [ ] Update CLI help text with examples

## Error Handling

### Configuration Errors

- **Config file missing**: Exit with error "Configuration file .sharkconfig.json not found. Run 'shark init' first."
- **No status_metadata**: Exit with error "No status_metadata defined in configuration"
- **No actions defined**: Display empty table with message "No orchestrator actions defined in workflow configuration"

### Filter Errors

- **Status not found** (`--status` flag): Exit code 1 with message "Status '{status}' not found in workflow configuration"
- **Invalid action type** (`--action-type` flag): Exit code 1 with message "Invalid action type '{type}'. Valid types: spawn_agent, pause, wait_for_triage, archive"

### Output Errors

- **JSON parsing error**: Should not occur (internal error), log and exit with code 2
- **Table rendering error**: Fallback to simple list format if table rendering fails

## Acceptance Criteria

Based on Story 6:

- [ ] `shark workflow show-actions` displays all actions
- [ ] Output grouped by workflow phase (planning, development, review, qa, approval, done, any)
- [ ] Shows agent type and action type for each status
- [ ] Supports JSON format for programmatic access (`--json` flag)
- [ ] Human-readable format is clear and well-organized
- [ ] Summary section shows total counts and breakdown by action type
- [ ] `--status` filter works correctly
- [ ] `--action-type` filter works correctly
- [ ] Handles missing orchestrator actions gracefully (shows "-" or omits)
- [ ] Exit codes are correct (0 = success, 1 = not found, 2 = error)

## Testing Requirements

### Unit Tests

**Config Parsing**:
- [ ] Parse workflow config with orchestrator actions
- [ ] Handle missing orchestrator_action (should not error)
- [ ] Handle malformed orchestrator_action (should error)

**Phase Grouping**:
- [ ] Statuses grouped correctly by phase
- [ ] Phase ordering is correct (planning → development → review → qa → approval → done → any)
- [ ] Statuses with unknown phases handled gracefully

**Summary Calculation**:
- [ ] Total status count correct
- [ ] Action type counts correct (spawn_agent, pause, etc.)
- [ ] Empty workflow (no actions) handled correctly

**Filtering**:
- [ ] `--status` filter returns correct action
- [ ] `--status` with non-existent status returns error
- [ ] `--action-type` filter returns only matching actions
- [ ] `--action-type` with invalid type returns error

### Integration Tests

**End-to-End Command**:
- [ ] Command with no flags displays all actions grouped by phase
- [ ] Command with `--json` outputs valid JSON
- [ ] Command with `--status` filters correctly
- [ ] Command with `--action-type` filters correctly
- [ ] Command works with real `.sharkconfig.json`

**Output Format Validation**:
- [ ] Table format is readable and well-aligned
- [ ] JSON format matches specification
- [ ] Summary section is accurate
- [ ] Colors applied correctly (when `--no-color` not set)

**Error Cases**:
- [ ] Missing config file produces clear error
- [ ] Empty workflow produces empty output (no crash)
- [ ] Invalid filter values produce clear error messages

## Usage Examples

### Example 1: View All Actions

```bash
$ shark workflow show-actions

# Shows table grouped by phase with all orchestrator actions
```

### Example 2: View Actions in JSON

```bash
$ shark workflow show-actions --json

# Outputs JSON array of all actions
```

### Example 3: View Action for Specific Status

```bash
$ shark workflow show-actions --status ready_for_development

Status: ready_for_development
Phase: development
Action: spawn_agent
Agent Type: developer
Skills: test-driven-development, implementation, shark-task-management
Instruction Template:
  Launch a developer agent to implement task {task_id}. Write tests first,
  then implement to pass tests following the technical specifications.
```

### Example 4: Filter by Action Type

```bash
$ shark workflow show-actions --action-type spawn_agent

# Shows only statuses with spawn_agent actions
```

### Example 5: Combine Filters

```bash
$ shark workflow show-actions --action-type spawn_agent --json

# JSON output of only spawn_agent actions
```

## Notes

- This command is READ-ONLY - it does not modify configuration
- Output should be easy to read and understand for workflow documentation
- Consider this the "overview" or "map" of the workflow
- Useful for onboarding new team members to understand agent flow
- Can be used to generate workflow documentation
- Should work even if no orchestrator_action is defined (shows empty table)
- Performance should be fast (<100ms) as it only reads configuration file
