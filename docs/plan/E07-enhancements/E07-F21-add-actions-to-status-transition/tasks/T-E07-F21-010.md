
---
key: T-E07-F21-010
title: Implement config get-status-action command
epic: E07
feature: E07-F21
agent: backend
status: todo
priority: 7
depends_on: ["T-E07-F21-001", "T-E07-F21-002", "T-E07-F21-004"]
created_at: 2026-01-15T01:52:59Z
---

# Task: Implement config get-status-action command

## Goal

Implement a CLI command `shark config get-status-action <status>` that returns the orchestrator action definition for a given status. This is a debugging and testing utility for workflow configuration developers to query what action would be triggered for a status without actually transitioning a task.

## Command Specification

### Command Syntax

```bash
shark config get-status-action <status> [--task=<task-key>] [--json]
```

### Arguments

- **status** (required): The status name to query (e.g., `ready_for_development`, `in_refinement_ba`)

### Flags

- `--task <task-key>`: Optional task key to populate template variables (e.g., `{task_id}`)
- `--json`: Output in machine-readable JSON format
- Standard global flags: `--verbose`, `--no-color`

### Examples

```bash
# Get action for status (template not populated)
shark config get-status-action ready_for_development

# Get action with task context (template populated)
shark config get-status-action ready_for_development --task=T-E01-F03-002

# JSON output for programmatic access
shark config get-status-action in_refinement_ba --json

# Check action for blocked status
shark config get-status-action blocked --task=T-E01-F03-005 --json
```

## Implementation Details

### Configuration Service Integration

- [ ] Use existing config service from T-E07-F21-004
- [ ] Load `.sharkconfig.json` via config service
- [ ] Access `status_metadata[status].orchestrator_action`
- [ ] Handle missing status gracefully

### Template Variable Population

When `--task` flag is provided:
- [ ] Parse task key to validate format
- [ ] Replace `{task_id}` in `instruction_template` with actual task key
- [ ] Future: May support additional variables like `{epic_id}`, `{feature_id}`

When `--task` flag is NOT provided:
- [ ] Return action with unpopulated template (leave `{task_id}` as-is)
- [ ] Useful for viewing raw configuration

### Error Handling

- [ ] **Status not found**: Exit code 1, message "Status 'xyz' not found in config"
- [ ] **No action defined**: Exit code 0, message "No orchestrator action defined for status 'xyz'"
- [ ] **Invalid task key format**: Exit code 1, message "Invalid task key format: xyz"
- [ ] **Config load error**: Exit code 2, message "Failed to load configuration: <error>"

### Output Formats

**Human-Readable Output:**
```
Status: ready_for_development
Action: spawn_agent
Agent Type: developer
Skills: [test-driven-development, implementation, shark-task-management]
Instruction:
  Launch a developer agent to implement task T-E01-F03-002. Write tests
  first, then implement to pass tests following the technical specifications.
```

**JSON Output:**
```json
{
  "status": "ready_for_development",
  "action": {
    "action": "spawn_agent",
    "agent_type": "developer",
    "skills": [
      "test-driven-development",
      "implementation",
      "shark-task-management"
    ],
    "instruction": "Launch a developer agent to implement task T-E01-F03-002..."
  }
}
```

**When No Action Defined:**
```json
{
  "status": "completed",
  "action": null
}
```

## Acceptance Criteria

From Story #3 in feature PRD:

- [ ] `shark config get-status-action <status>` returns action definition
- [ ] Command supports `--task` flag to populate template variables
- [ ] JSON output format matches transition response format (consistent with task update)
- [ ] Error messages are clear for missing or invalid actions
- [ ] Command works with both JSON and human-readable output
- [ ] Exit codes follow Shark conventions (0=success, 1=not found, 2=config error)

### Additional Criteria

- [ ] Status name is case-insensitive (matches existing Shark behavior)
- [ ] Template population only happens when `--task` is provided
- [ ] Unpopulated templates show raw `{task_id}` placeholder
- [ ] Command validates task key format when `--task` is provided
- [ ] Help text includes usage examples
- [ ] Error suggests using `shark workflow show-actions` to see available statuses

## Testing Requirements

### Unit Tests

- [ ] **Config service integration**: Load status metadata and extract action
- [ ] **Template population**: Replace `{task_id}` with actual task key
- [ ] **Template unpopulated**: Return raw template when `--task` not provided
- [ ] **Status not found**: Return appropriate error
- [ ] **No action defined**: Return null action (not error)
- [ ] **Invalid task key**: Validate and return error

### CLI Command Tests (Use Mocks)

**CRITICAL**: CLI tests must use MOCKED config service, never real config files.

- [ ] Test command with valid status
- [ ] Test command with `--task` flag
- [ ] Test command with `--json` flag
- [ ] Test error handling for missing status
- [ ] Test error handling for invalid task key
- [ ] Test both JSON and human-readable output formats

### Integration Tests

- [ ] End-to-end: Load real `.sharkconfig.json` and query action
- [ ] Verify JSON output matches task update response format
- [ ] Test with actual workflow configuration examples (wormwoodGM)
- [ ] Test case-insensitive status matching

### Test Scenarios

**Scenario 1: Debug workflow without task context**
```bash
shark config get-status-action ready_for_development
# Expected: Shows raw action with {task_id} placeholder
```

**Scenario 2: Test action with specific task**
```bash
shark config get-status-action ready_for_development --task=T-E01-F03-002
# Expected: Shows action with populated instruction
```

**Scenario 3: Query status with no action**
```bash
shark config get-status-action completed --json
# Expected: {"status": "completed", "action": null}
```

**Scenario 4: Invalid status**
```bash
shark config get-status-action invalid_status
# Expected: Exit 1, "Status 'invalid_status' not found in config"
```

## Notes

### Usage Scenarios

**Workflow Development**: Developers use this command to verify orchestrator actions are correctly defined for each status before deploying configuration changes.

**Debugging**: When orchestrator behavior is unexpected, use this command to confirm what action Shark would return for a status transition.

**Testing**: CI/CD pipelines can use this command to validate workflow configurations as part of automated testing.

### Implementation Notes

- Command goes in `internal/cli/commands/config.go` (extends existing config command)
- Reuse config service from T-E07-F21-004
- Template population logic should be simple string replacement (not full template engine)
- Output format should match `orchestrator_action` object returned by task update command

### Dependencies

- **T-E07-F21-001**: Schema must be finalized
- **T-E07-F21-002**: Template structure must be defined
- **T-E07-F21-004**: Config service must be implemented and tested
