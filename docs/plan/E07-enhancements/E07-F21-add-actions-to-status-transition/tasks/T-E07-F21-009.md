
---
key: T-E07-F21-009
title: Document task update API response format
epic: E07
feature: E07-F21
agent: general
status: todo
priority: 6
depends_on: ["T-E07-F21-006"]
created_at: 2026-01-15T01:52:57Z
---

# Task: Document task update API response format

## Goal

Create comprehensive documentation for the enhanced task update API response format that includes `orchestrator_action` metadata. This documentation is critical for orchestrator developers to integrate with the new workflow-driven agent spawning feature.

**Context**: T-E07-F21-006 introduces `orchestrator_action` in API responses. This task documents the format, usage patterns, migration path, and integration guidelines for developers building AI agent orchestrators.

**User Story**: As an orchestrator developer, I need complete documentation of the API response format so that I can integrate orchestrator actions without trial-and-error or reading source code (Story 1 supporting documentation).

## Requirements

### Functional Requirements

1. **Complete API Response Specification**
   - [ ] Document JSON response structure with all fields
   - [ ] Define OrchestratorAction object schema (action, agent_type, skills, instruction)
   - [ ] Specify when orchestrator_action is present vs omitted
   - [ ] Document backward compatibility guarantees

2. **Response Format Examples**
   - [ ] Example for each action type: `spawn_agent`, `pause`, `wait_for_triage`, `archive`
   - [ ] Example with orchestrator_action present
   - [ ] Example with orchestrator_action omitted (no action defined)
   - [ ] Example for each status transition command (start, complete, approve, etc.)

3. **Integration Guidelines**
   - [ ] How to parse orchestrator_action from responses
   - [ ] How to handle missing actions gracefully (fallback logic)
   - [ ] Template variable population specification ({task_id})
   - [ ] Error handling patterns

4. **Migration Guide**
   - [ ] Updating existing orchestrators to use new response format
   - [ ] Backward compatibility notes (what doesn't break)
   - [ ] Deprecation timeline (if any)
   - [ ] Testing integration changes

### Non-Functional Requirements

1. **Documentation Quality**
   - [ ] Clear, concise language for developers
   - [ ] Complete working code examples
   - [ ] No assumptions about prior knowledge
   - [ ] Examples tested and validated

2. **Accessibility**
   - [ ] Documentation discoverable via CLI help
   - [ ] Linked from README and feature docs
   - [ ] Searchable (good headers, keywords)
   - [ ] Version-specific (indicate Shark version requirements)

3. **Maintainability**
   - [ ] Documentation lives near code (docs/ directory)
   - [ ] Examples validated by automated tests
   - [ ] Clear versioning/changelog for API changes
   - [ ] Easy to update when schema evolves

## Implementation Plan

### Documentation Locations

1. **Primary Documentation**: `/docs/CLI_REFERENCE.md`
   - Section: "Task Update API Response Format"
   - Subsections:
     - Response Structure
     - OrchestratorAction Object
     - Field Descriptions
     - Action Types
     - Examples
     - Migration Guide

2. **API Reference**: `/docs/API_REFERENCE.md` (create if needed)
   - Section: "Task Management API"
   - Subsections:
     - Endpoint: `shark task update`
     - Request Format
     - Response Format (with orchestrator_action)
     - Status Codes
     - Error Responses

3. **README Update**: `/README.md`
   - Add "Orchestrator Integration" section
   - Link to full API documentation
   - Quick example of parsing orchestrator_action
   - Link to feature PRD

4. **Feature Documentation**: Link from feature.md
   - Update `/docs/plan/E07-enhancements/E07-F21-add-actions-to-status-transition/feature.md`
   - Add "Documentation" section with links to API docs

5. **CLI Help Text**: Update command help
   - `shark task update --help` should mention orchestrator_action
   - `shark task start --help`, `shark task complete --help`, etc.
   - Link to online docs for full reference

### Steps

1. **Phase 1: API Specification** (2 hours)
   - [ ] Document complete JSON response structure from T-E07-F21-006
   - [ ] Define OrchestratorAction object schema with all fields
   - [ ] Specify field types, required/optional, constraints
   - [ ] Document backward compatibility (field omission)

2. **Phase 2: Response Examples** (2 hours)
   - [ ] Create example for `spawn_agent` action type
   - [ ] Create example for `pause` action type
   - [ ] Create example for `wait_for_triage` action type
   - [ ] Create example for `archive` action type
   - [ ] Create example with no action defined (field omitted)
   - [ ] Create examples for all transition commands

3. **Phase 3: Integration Guidelines** (2 hours)
   - [ ] Write parsing examples (Go, Python, JavaScript)
   - [ ] Document fallback logic for missing actions
   - [ ] Explain template variable population
   - [ ] Document error handling patterns
   - [ ] Add troubleshooting section

4. **Phase 4: Migration Guide** (1 hour)
   - [ ] Write before/after orchestrator code comparison
   - [ ] Document breaking changes (none, but be explicit)
   - [ ] Create testing checklist for integration
   - [ ] Document rollback plan if needed

5. **Phase 5: Cross-Linking** (1 hour)
   - [ ] Update CLI_REFERENCE.md with new section
   - [ ] Create/update API_REFERENCE.md
   - [ ] Update README.md with integration section
   - [ ] Update feature.md with documentation links
   - [ ] Update CLI help text for relevant commands

6. **Phase 6: Validation** (1 hour)
   - [ ] Test all examples with actual Shark CLI
   - [ ] Verify JSON output matches documentation
   - [ ] Check all internal links work
   - [ ] Spell check and grammar review

### Technical Approach

**Documentation Format**:
- Markdown for all documentation files
- Use code blocks with syntax highlighting (```json, ```go, ```bash)
- Include both JSON output and human-readable explanations
- Use tables for field definitions
- Use diagrams for workflow flow (if needed)

**Example Structure**:
```markdown
## Response Format

### JSON Output Structure

**Complete Task Update Response**:
```json
{
  "id": 123,
  "key": "T-E01-F03-002",
  ...
  "orchestrator_action": {
    "action": "spawn_agent",
    "agent_type": "architect",
    "skills": ["architecture", "system-design"],
    "instruction": "Launch an architect agent for task T-E01-F03-002..."
  }
}
```

### Field Descriptions

| Field | Type | Required | Description |
|-------|------|----------|-------------|
| orchestrator_action | Object | No | Action metadata (omitted if no action defined) |
| orchestrator_action.action | String | Yes | Action type: spawn_agent, pause, wait_for_triage, archive |
| orchestrator_action.agent_type | String | Conditional | Required if action=spawn_agent |
| ... | ... | ... | ... |

### Action Types

**spawn_agent**: Launch a new agent to work on task
- **Required fields**: action, agent_type, skills, instruction
- **Example**: See Section X

**pause**: Wait, do not spawn agent
- **Required fields**: action, instruction
- **Example**: See Section Y
```

**Validation Approach**:
- Extract all JSON examples to test files
- Automated test validates examples against actual CLI output
- CI/CD fails if examples are stale

## Deliverables

1. **CLI_REFERENCE.md Updates**
   - [ ] New section: "Task Update API Response Format"
   - [ ] Subsections: Response Structure, OrchestratorAction, Examples, Migration

2. **API_REFERENCE.md** (new file)
   - [ ] Complete API documentation for task management
   - [ ] Request/response formats with orchestrator_action
   - [ ] Error codes and handling

3. **README.md Updates**
   - [ ] New section: "Orchestrator Integration"
   - [ ] Quick start example for parsing orchestrator_action
   - [ ] Links to full documentation

4. **Feature PRD Updates**
   - [ ] Add "Documentation" section to feature.md
   - [ ] Link to all documentation artifacts

5. **CLI Help Text Updates**
   - [ ] Update `shark task update --help`
   - [ ] Update other transition command help texts
   - [ ] Add links to online documentation

6. **Example Files**
   - [ ] `/docs/examples/orchestrator-integration.md` (code examples)
   - [ ] `/docs/examples/response-parsing.go` (Go example)
   - [ ] `/docs/examples/response-parsing.py` (Python example)

## Acceptance Criteria

**Documentation Completeness**:
- [ ] All fields in OrchestratorAction documented with types, constraints
- [ ] All four action types have complete examples
- [ ] Migration guide covers updating existing orchestrators
- [ ] Error handling documented (missing actions, invalid actions)
- [ ] Backward compatibility explicitly stated

**Example Quality**:
- [ ] All JSON examples are valid and tested
- [ ] Examples include realistic task data (not placeholder text)
- [ ] Code examples work copy-paste (tested)
- [ ] Examples cover common use cases (spawn_agent is most common)

**Integration Guidelines**:
- [ ] Parsing examples in at least 2 languages (Go + Python or JavaScript)
- [ ] Fallback logic documented clearly
- [ ] Template variable population explained
- [ ] Error scenarios covered

**Cross-Linking**:
- [ ] README links to API_REFERENCE
- [ ] CLI_REFERENCE links to examples
- [ ] Feature PRD links to documentation
- [ ] CLI help text references online docs

**Discoverability**:
- [ ] Orchestrator developer can find docs via README
- [ ] API reference searchable via Google (good headers)
- [ ] CLI help points to documentation
- [ ] Documentation version-tagged

## Testing Strategy

### Documentation Testing

1. **JSON Example Validation**
   - [ ] Extract all JSON examples to test files
   - [ ] Run automated validation against JSON schema
   - [ ] Compare examples to actual `shark task update` output
   - [ ] Fail CI if examples don't match reality

2. **Code Example Testing**
   - [ ] Compile and run Go examples
   - [ ] Execute Python examples with sample data
   - [ ] Verify examples produce expected output
   - [ ] Test error handling code paths

3. **Link Validation**
   - [ ] Check all internal links resolve correctly
   - [ ] Verify external links are valid (if any)
   - [ ] Test README links work on GitHub
   - [ ] Verify CLI help link format is correct

4. **Readability Testing**
   - [ ] Spell check all documentation
   - [ ] Grammar review with tool or manual
   - [ ] Ensure consistent terminology (e.g., always "orchestrator_action", not "action metadata")
   - [ ] Check for clarity with non-expert reviewer

### Manual Review

- [ ] Read through documentation as if you're an orchestrator developer
- [ ] Verify no assumptions about Shark internals
- [ ] Check examples are complete (no "..." placeholders without explanation)
- [ ] Confirm migration guide has actionable steps

## Dependencies

**MUST complete before starting**:
- T-E07-F21-006: Enhance task update response with orchestrator action
  - Need actual implementation to document response format
  - Need JSON schema from implementation
  - Need real examples from running commands

**Related tasks**:
- T-E07-F21-008: CLI utility commands (get-status-action, validate-actions)
  - Documentation should reference these commands for debugging

## Notes

### Documentation Principles

1. **Write for the reader, not the writer**
   - Assume orchestrator developer is smart but unfamiliar with Shark internals
   - Provide context and motivation, not just reference data
   - Anticipate common questions and answer them preemptively

2. **Show, don't just tell**
   - Every concept should have a working example
   - Examples should be realistic (not foo/bar placeholders)
   - Code examples must be tested and working

3. **Maintain accuracy**
   - Documentation should reflect actual implementation (T-E07-F21-006)
   - Examples must match CLI output exactly
   - Automated tests ensure docs stay in sync with code

4. **Enable progressive learning**
   - README has quick start (30 seconds to first success)
   - CLI_REFERENCE has common use cases (5 minutes)
   - API_REFERENCE has complete specification (reference material)
   - Examples directory has advanced patterns

### Key Documentation Sections

**Section 1: Response Format Overview**
- Purpose: Explain why orchestrator_action exists
- Audience: New orchestrator developers
- Content: High-level overview, benefits, when to use

**Section 2: JSON Schema Reference**
- Purpose: Complete technical specification
- Audience: Developers implementing parsers
- Content: All fields, types, constraints, validation rules

**Section 3: Action Type Guide**
- Purpose: Explain each action type semantics
- Audience: Workflow configuration managers
- Content: When to use each type, examples, common patterns

**Section 4: Integration Examples**
- Purpose: Help developers integrate quickly
- Audience: Orchestrator developers implementing feature
- Content: Copy-paste code examples, error handling, testing

**Section 5: Migration Guide**
- Purpose: Update existing orchestrators safely
- Audience: Developers with existing orchestrators
- Content: Before/after code, testing checklist, rollback plan

### Documentation Locations Rationale

**CLI_REFERENCE.md**:
- Already comprehensive reference for all CLI commands
- Developers familiar with Shark will look here first
- Logical place for API response format documentation

**API_REFERENCE.md** (new):
- Dedicated API documentation for orchestrator developers
- Can grow to include other API details (task list, config, etc.)
- Separates user-facing CLI docs from developer-facing API docs

**README.md**:
- Entry point for all developers
- Should have quick integration example
- Links to deeper documentation

**Examples directory**:
- Standalone examples that can be run independently
- Language-specific examples (Go, Python, JavaScript)
- Advanced patterns (polling, error recovery, etc.)

### Success Criteria

**Developer can integrate in 30 minutes**:
- Find documentation via README
- Understand response format from examples
- Copy-paste parsing code that works
- Handle missing actions gracefully
- Know where to get help

**Documentation requires no maintenance**:
- Examples validated by automated tests
- Schema changes caught by CI
- Documentation lives near code (not external wiki)

### Risks and Mitigations

**Risk**: Documentation gets out of sync with implementation
- **Mitigation**: Automated tests validate all examples
- **Mitigation**: Documentation review required for schema changes

**Risk**: Examples don't cover edge cases
- **Mitigation**: Enumerate all action types and create examples for each
- **Mitigation**: Include "no action defined" example (common case)

**Risk**: Migration guide is incomplete
- **Mitigation**: Test migration with actual orchestrator codebase
- **Mitigation**: Document both "ideal" and "minimal" migration approaches

**Risk**: Documentation too technical for some audiences
- **Mitigation**: Layer documentation (quick start → reference → advanced)
- **Mitigation**: Include diagrams for visual learners

### Estimated Time

- Phase 1 (API Specification): 2 hours
- Phase 2 (Response Examples): 2 hours
- Phase 3 (Integration Guidelines): 2 hours
- Phase 4 (Migration Guide): 1 hour
- Phase 5 (Cross-Linking): 1 hour
- Phase 6 (Validation): 1 hour

**Total**: 9 hours (slightly over typical task size, but documentation is critical)

### Implementation Checklist

**Before Starting**:
- [ ] T-E07-F21-006 is complete and merged
- [ ] Can run `shark task update` and see orchestrator_action in output
- [ ] Have access to JSON schema from implementation

**During Implementation**:
- [ ] Extract actual JSON from running commands (don't invent examples)
- [ ] Test all code examples before including them
- [ ] Ask for review from orchestrator developer (validate usefulness)
- [ ] Check examples work on fresh Shark installation

**Before Completing**:
- [ ] All examples validated by automated tests
- [ ] Spell check and grammar review complete
- [ ] Links work and point to correct sections
- [ ] Documentation reviewed by at least one other developer
