
---
key: T-E07-F16-003
title: Implement WorkflowService core
epic: E07
feature: E07-F16
agent: backend
status: todo
priority: 8
created_at: 2026-01-02T14:17:31Z
---

# Task: Implement WorkflowService core

## Goal

Create the WorkflowService to centralize workflow config access across all CLI commands.

## Description

This is the foundation task for workflow config integration. The WorkflowService will load and cache the `.sharkconfig.json` file, providing a single source of truth for workflow status configuration. This eliminates code duplication and enables consistent workflow behavior across all commands.

**Priority:** 8
**Agent:** backend
**Dependencies:** None
**Estimated Effort:** 3-4 hours

## Acceptance Criteria

- [ ] Create `internal/workflow/service.go`
- [ ] Create `internal/workflow/types.go`
- [ ] Implement `NewService(projectRoot string) *Service` constructor
- [ ] Implement `GetWorkflow() *WorkflowConfig` method
- [ ] Implement `GetInitialStatus() TaskStatus` method
- [ ] Implement `GetAllStatuses() []string` method with phase ordering
- [ ] Implement `GetStatusMetadata(status string) StatusMetadata` method
- [ ] Implement `GetStatusesByPhase(phase string) []string` method
- [ ] Service loads and caches workflow config on construction
- [ ] Graceful fallback to default workflow when config missing
- [ ] Service handles invalid/malformed config gracefully

## Files to Create

- `internal/workflow/service.go` - Main service implementation
- `internal/workflow/types.go` - Type definitions (WorkflowConfig, StatusMetadata, etc.)

## Implementation Notes

**Key Design Points:**
- Load config once in constructor, cache in struct field
- Return default workflow if config file missing or invalid
- Use `internal/config` package for loading `.sharkconfig.json`
- Status ordering should respect workflow phase hierarchy
- Thread-safe (read-only after construction)

**Example Service Interface:**
```go
type Service struct {
    workflow *WorkflowConfig
    projectRoot string
}

func NewService(projectRoot string) *Service
func (s *Service) GetWorkflow() *WorkflowConfig
func (s *Service) GetInitialStatus() TaskStatus
func (s *Service) GetAllStatuses() []string
func (s *Service) GetStatusMetadata(status string) StatusMetadata
```

## Testing Requirements

### Unit Tests

- [ ] Test service creation with valid workflow config
- [ ] Test service creation with missing workflow config (fallback)
- [ ] Test service creation with invalid workflow config (fallback)
- [ ] Test `GetInitialStatus()` returns first entry status
- [ ] Test `GetAllStatuses()` returns ordered status list
- [ ] Test `GetStatusMetadata()` returns correct metadata
- [ ] Test `GetStatusesByPhase()` filters correctly
- [ ] Test caching behavior (config loaded once)
- [ ] Code coverage > 80%

## Related Documentation

See `/dev-artifacts/2026-01-02-feature-get-workflow-enhancement/implementation-examples.md` for complete code examples.
