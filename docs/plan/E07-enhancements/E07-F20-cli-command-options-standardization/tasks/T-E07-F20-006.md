
---
key: T-E07-F20-006
title: Add short task key pattern and normalization function
epic: E07
feature: E07-F20
agent: backend
status: todo
priority: 7
created_at: 2026-01-03T22:00:44Z
---

# Task: Add short task key pattern and normalization function

## Goal

Enable users to omit the `T-` prefix from task keys. This allows `e01-f02-001` instead of requiring `t-e01-f02-001`, making commands shorter and cleaner while maintaining backward compatibility.

## Implementation Details

### File Location
`/home/jwwelbor/projects/shark-task-manager/internal/cli/commands/helpers.go`

### Pattern to Add

```go
// shortTaskKeyPattern matches task keys without the T- prefix (E##-F##-###)
var shortTaskKeyPattern = regexp.MustCompile(`^E\d{2}-F\d{2}-\d{3}$`)
```

### Function to Add

```go
// NormalizeTaskKey converts a task key to canonical format with T- prefix.
// Accepts both full format (T-E##-F##-###) and short format (E##-F##-###).
//
// Examples:
//   T-E01-F02-001 → T-E01-F02-001 (no change)
//   e01-f02-001 → T-E01-F02-001 (add prefix, uppercase)
//   E01-F02-001 → T-E01-F02-001 (add prefix)
//   e01-f02-001-task-name → T-E01-F02-001-TASK-NAME (slugged, add prefix)
func NormalizeTaskKey(input string) (string, error) {
	// First normalize case
	normalized := strings.ToUpper(input)

	// Already has T- prefix
	if strings.HasPrefix(normalized, "T-") {
		return normalized, nil
	}

	// Check if it matches short format (E##-F##-###)
	if shortTaskKeyPattern.MatchString(normalized) {
		return "T-" + normalized, nil
	}

	// Check for slugged short format (E##-F##-###-slug)
	parts := strings.SplitN(normalized, "-", 4)
	if len(parts) >= 3 {
		keyPart := strings.Join(parts[:3], "-")
		if shortTaskKeyPattern.MatchString(keyPart) {
			return "T-" + normalized, nil
		}
	}

	// If none of the above, return as-is and let validation catch it
	return normalized, nil
}
```

### Estimated Time
1 hour

## Acceptance Criteria

- [ ] shortTaskKeyPattern regex added
- [ ] NormalizeTaskKey() function implemented
- [ ] Function handles both full and short formats
- [ ] Function handles slugged keys correctly
- [ ] Case normalization integrated
- [ ] No breaking changes to existing keys

## Testing Requirements

### Unit Tests
Will be covered in T-E07-F20-008 (Add tests for short task key format)

Test cases needed:
- Full format uppercase: "T-E01-F02-001" → "T-E01-F02-001"
- Full format lowercase: "t-e01-f02-001" → "T-E01-F02-001"
- Short format uppercase: "E01-F02-001" → "T-E01-F02-001"
- Short format lowercase: "e01-f02-001" → "T-E01-F02-001"
- Short format mixed case: "E01-f02-001" → "T-E01-F02-001"
- Slugged full format: "T-E01-F02-001-task-name" → "T-E01-F02-001-TASK-NAME"
- Slugged short format: "e01-f02-001-task-name" → "T-E01-F02-001-TASK-NAME"

## Related Documentation

- Implementation Guide: `/home/jwwelbor/projects/shark-task-manager/docs/workflow/artifacts/F20-implementation-guide.md` (lines 458-520)
- Enhancement Approval: `/home/jwwelbor/projects/shark-task-manager/docs/workflow/artifacts/F20-short-key-enhancement-approval.md`

## Dependencies

- T-E07-F20-001: Add key normalization function (must be completed first)

## Notes

- This is Phase 1.5 - fits naturally into Week 2 alongside case normalization
- Only 15 lines of code, minimal complexity
- No database changes required
- Purely a CLI parsing enhancement
- 2.5% reduction in keystrokes for users who type task keys manually
