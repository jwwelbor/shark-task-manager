# Code Review: T-E07-F22-014
## Update CLI reference documentation for rejection reasons

**Reviewer:** TechLead Agent
**Date:** 2026-01-16
**Commit:** 896000988ce34ea511decd063238952a7ba490e3
**Status:** ‚ùå REJECTED - Critical Documentation Bug

---

## Executive Summary

The CLI reference documentation update contains **critical inconsistencies** between the documented flag names and the actual implementation. The documentation uses `--reason` throughout, but the actual CLI command uses `--rejection-reason`. This will cause **100% command failure rate** for users following the documentation.

**Impact:** HIGH - All documented examples will fail when users try them
**Recommendation:** Fix flag name inconsistency before approval

---

## Critical Issues (Must Fix)

### 1. Incorrect Flag Name Throughout Documentation

**Issue:** Documentation uses `--reason` flag, but actual implementation uses `--rejection-reason`

**Evidence:**
```bash
# Documentation says (line 684):
shark task reopen <task-key> [--reason="..."]

# Actual command help shows:
--rejection-reason string   Reason for rejection or sending task back

# Testing confirms --reason doesn't work:
$ ./bin/shark task reopen E07-F22-001 --reason="test"
Error: unknown flag: --reason
```

**Affected Sections:**
- Line 684: `shark task reopen` usage
- Line 688: Flag documentation for `--reason`
- Lines 701, 705, 709, 714: All command examples
- Lines 808-830: Rejection reason flag section
- Lines 822-829: All example commands
- Lines 958-977: Command examples section
- Lines 1010: Error message example
- Lines 1038: Best practices section
- Line 1076: Related commands section

**Impact:**
- Every single documented example will fail
- Users will be unable to use the rejection reason feature
- Documentation becomes actively harmful rather than helpful

**Fix Required:**
Replace all instances of `--reason` with `--rejection-reason` throughout the document.

### 2. Table of Contents Entry May Be Missing

**Issue:** Need to verify the "Rejection Reasons for Status Transitions" section is properly linked in TOC

**Evidence:**
```markdown
# Line 12 in TOC:
- [Rejection Reasons for Status Transitions](#rejection-reasons-for-status-transitions)

# Line 774 in document:
## Rejection Reasons for Status Transitions
```

**Status:** ‚úÖ Verified - TOC link is correct

---

## Quality Assessment

### Completeness ‚úÖ

The documentation is **comprehensive** and covers:
- ‚úÖ Overview and key features
- ‚úÖ Backward transition detection
- ‚úÖ Flag descriptions (`--reason`, `--reason-doc`, `--force`)
- ‚úÖ Viewing rejection history (terminal and JSON)
- ‚úÖ Command examples for different scenarios
- ‚úÖ Error message documentation
- ‚úÖ Best practices for reviewers and developers
- ‚úÖ Related commands section

### Structure and Organization ‚úÖ

The documentation is **well-structured**:
- ‚úÖ Logical flow from overview ‚Üí flags ‚Üí examples ‚Üí best practices
- ‚úÖ Clear section headings
- ‚úÖ Proper use of markdown formatting
- ‚úÖ Code blocks for all examples
- ‚úÖ Tables for backward transitions

### Content Quality ‚úÖ

The content is **high-quality** with:
- ‚úÖ Clear explanations of rejection reason purpose
- ‚úÖ Specific backward transition scenarios documented
- ‚úÖ Concrete examples (not vague)
- ‚úÖ Best practices with ‚úÖ/‚ùå indicators
- ‚úÖ JSON output format examples
- ‚úÖ Error message examples with context

### Examples ‚ùå

The examples are **comprehensive but broken**:
- ‚ùå All examples use wrong flag name (`--reason` instead of `--rejection-reason`)
- ‚úÖ Good variety of use cases covered
- ‚úÖ Both simple and complex scenarios shown
- ‚úÖ Terminal and JSON output examples provided

### Integration with Existing Docs ‚úÖ

The new section integrates well:
- ‚úÖ Follows existing CLI_REFERENCE.md conventions
- ‚úÖ Matches formatting style of other sections
- ‚úÖ Table of contents updated
- ‚úÖ Cross-references to related commands

---

## Minor Issues (Nice to Have)

### 1. Command Workflow Section References Non-Existent Commands

**Issue:** Documentation references future commands that don't exist yet

**Location:** Line 1078-1080
```markdown
- `shark task list` - Filter by rejection indicators (future)
- `shark task timeline` - View rejection events in timeline (future)
- `shark task docs` - View linked documents (future)
```

**Recommendation:** These are clearly marked as "(future)", which is acceptable. No change needed.

### 2. Backward Transition Table Could Include More Statuses

**Issue:** Table at line 792-799 only shows a subset of possible backward transitions

**Current Coverage:**
- ready_for_code_review ‚Üí in_development ‚úÖ
- ready_for_qa ‚Üí in_development ‚úÖ
- in_qa ‚Üí in_development ‚úÖ
- ready_for_approval ‚Üí ready_for_qa ‚úÖ
- in_approval ‚Üí ready_for_qa ‚úÖ
- ready_for_review ‚Üí in_progress ‚úÖ

**Recommendation:** This appears comprehensive for the current workflow. No change needed.

---

## Testing the Documentation

### Manual Testing Performed

1. ‚úÖ Verified TOC links work correctly
2. ‚ùå Tested example commands - all fail due to wrong flag name
3. ‚úÖ Verified section headings are consistent
4. ‚úÖ Checked markdown formatting renders correctly
5. ‚úÖ Validated JSON examples are properly formatted

### Recommended User Testing

Before approval, perform:
1. Copy-paste each example command from documentation
2. Verify it works without modification
3. Test both terminal and JSON output modes
4. Verify error messages match documentation

---

## Code Review Checklist

### Documentation Quality
- ‚úÖ Clear and concise language
- ‚úÖ Proper grammar and spelling
- ‚úÖ Consistent terminology
- ‚úÖ Appropriate level of detail
- ‚úÖ Good use of formatting (headings, lists, code blocks)

### Accuracy
- ‚ùå **CRITICAL:** Flag names don't match implementation
- ‚úÖ Command syntax is correct (except flag names)
- ‚úÖ Examples are realistic and useful
- ‚úÖ Error messages match actual error messages
- ‚úÖ Workflow transitions are accurate

### Completeness
- ‚úÖ All major features documented
- ‚úÖ Edge cases covered
- ‚úÖ Best practices included
- ‚úÖ Error handling documented
- ‚úÖ Related commands referenced

### Maintainability
- ‚úÖ Easy to update when features change
- ‚úÖ Clear section organization
- ‚úÖ Good use of examples
- ‚úÖ Cross-references where appropriate

---

## Required Changes

### High Priority (Must Fix Before Approval)

1. **Replace all instances of `--reason` with `--rejection-reason`**

   Affected lines (approximate):
   - Line 684: Usage statement
   - Line 688: Flag description
   - Lines 701-719: All command examples in `shark task reopen` section
   - Line 809: Flag section heading
   - Lines 822-829: Best practices examples
   - Lines 958-977: Command examples section
   - Line 1010: Error message example
   - Line 1038: Best practices section

   **Search and replace pattern:**
   ```
   Find: --reason="
   Replace: --rejection-reason="

   Find: --reason <
   Replace: --rejection-reason <
   ```

2. **Update flag description at line 688**

   Current:
   ```markdown
   - `--reason <string>`: Required for backward transitions.
   ```

   Should be:
   ```markdown
   - `--rejection-reason <string>`: Required for backward transitions.
   ```

3. **Update usage examples format strings**

   Current:
   ```markdown
   --reason="<explanation>"
   ```

   Should be:
   ```markdown
   --rejection-reason="<explanation>"
   ```

---

## Verification Steps After Fix

1. **Grep for remaining `--reason` instances:**
   ```bash
   grep -n -- '--reason[^-]' docs/CLI_REFERENCE.md
   ```
   Should return NO matches in the rejection reasons section

2. **Test all documented examples:**
   ```bash
   # Example 1 (line 701):
   shark task reopen E07-F01-001 --rejection-reason="Missing error handling for database.Query() on line 67"

   # Example 2 (line 708):
   shark task reopen E07-F01-001 \
     --rejection-reason="Found 3 critical issues. See code review document for details." \
     --reason-doc="docs/reviews/E07-F01-001-code-review.md"
   ```

3. **Verify command help matches documentation:**
   ```bash
   shark task reopen --help
   ```
   Compare flags listed against documented flags

---

## Approval Criteria

Before this task can be approved:

- [ ] All instances of `--reason` replaced with `--rejection-reason` in rejection reasons section
- [ ] All command examples verified to work
- [ ] Command help output matches documented flags
- [ ] No broken examples in documentation
- [ ] Table of contents still links correctly

---

## Positive Observations

Despite the critical flag name issue, this documentation is **excellent quality**:

1. **Comprehensive coverage** - Every aspect of rejection reasons is documented
2. **Great examples** - Shows both simple and complex use cases
3. **Best practices** - Clear DO/DON'T guidance for reviewers and developers
4. **Error documentation** - Error messages with context and solutions
5. **JSON examples** - Machine-readable format documented alongside human-readable
6. **Workflow integration** - Shows how rejection reasons fit into broader workflow

Once the flag name is corrected, this will be **outstanding documentation**.

---

## Recommendation

**REJECT** and return to developer with specific instructions to:

1. Replace all `--reason` with `--rejection-reason` in the "Rejection Reasons for Status Transitions" section
2. Verify all examples work after the change
3. Update PR/commit with corrected documentation

**Estimated Fix Time:** 15-20 minutes (search and replace + testing)

**Re-review Required:** Yes, to verify all examples work correctly

---

## Summary

**Severity:** üî¥ Critical
**Decision:** ‚ùå REJECTED
**Reason:** Flag name mismatch between documentation and implementation
**Impact:** All documented examples fail when users try them
**Fix Difficulty:** Easy (search and replace)
**Re-review ETA:** Same day once fixed

The documentation is otherwise **excellent quality** and will be ready for approval once this critical issue is fixed.
