# QA Results: T-E07-F22-014 - Update CLI reference documentation for rejection reasons

**Date:** 2026-01-17
**Time:** 01:26:55
**Task:** T-E07-F22-014
**QA Agent:** qa-agent
**Status:** FAILED - Critical issues found

---

## Test Summary

| Category | Pass | Fail | Total |
|---|---|---|---|
| Documentation Structure | 3 | 0 | 3 |
| Content Accuracy | 3 | 1 | 4 |
| Link Validation | 3 | 0 | 3 |
| Example Verification | 4 | 0 | 4 |
| **TOTAL** | **13** | **1** | **14** |

**Overall Result:** ❌ FAIL

---

## Passed Tests

### ✅ Documentation Structure
1. **Main index link exists** - docs/CLI_REFERENCE.md correctly links to rejection-reasons.md
2. **Document created** - docs/cli-reference/rejection-reasons.md exists and is well-structured
3. **Cross-references valid** - All referenced documents (task-commands-full.md, workflow-config.md, error-messages.md) exist

### ✅ Command Examples
1. **Flag names correct** - Documentation correctly uses `--rejection-reason` and `--reason-doc`
2. **JSON structure accurate** - `rejection_history` field format matches actual implementation
3. **Command help verified** - `shark task reopen --help` and `shark task approve --help` both show rejection reason flags
4. **Timeline command exists** - `shark task timeline` command referenced in documentation exists

### ✅ Link Validation
1. **Internal links valid** - All relative links to other CLI reference docs are correct
2. **Document paths correct** - All example file paths follow project conventions
3. **Related docs linked** - Proper cross-referencing to task-commands, workflow-config, error-messages

---

## Failed Tests

### ❌ Status Name Accuracy (CRITICAL)

**Issue:** Backward transition table uses incorrect status names

**Location:** docs/cli-reference/rejection-reasons.md, lines 19-26

**Current (Incorrect):**
```markdown
| From Status | To Status | Context |
|---|---|---|
| `ready_for_code_review` | `in_development` | Code reviewer rejects task |
| `ready_for_qa` | `in_development` | QA finds bugs |
| `in_qa` | `in_development` | QA returns task for fixes |
```

**Expected (Correct per .sharkconfig.json workflow):**
```markdown
| From Status | To Status | Context |
|---|---|---|
| `in_code_review` | `in_development` | Code reviewer rejects task |
| `in_qa` | `in_development` | QA finds bugs |
| `in_approval` | `ready_for_qa` | Approval returns for rework |
```

**Explanation:**
- Actual workflow config shows `in_code_review → in_development` (not `ready_for_code_review`)
- Table incorrectly mixes `ready_for_*` and `in_*` status names
- This will confuse users trying to use the rejection reason feature

**Impact:** HIGH - Users will try to use incorrect status names and get errors

---

## Observations

### Minor Issues (Non-Blocking)

1. **Error message bug reference:**
   - Repository code (task_repository.go) says "use --reason flag" but actual flag is `--rejection-reason`
   - Documentation is correct; code has a minor bug
   - Recommend creating separate task to fix error message in repository

2. **Workflow phase terminology:**
   - Documentation uses both "ready_for_*" and "in_*" interchangeably
   - Should clarify distinction: "ready_for_X" = waiting, "in_X" = active work

---

## Recommendations

### Required Changes (Must Fix Before Approval)

1. **Fix backward transition table** (lines 19-26 in rejection-reasons.md)
   - Replace `ready_for_code_review` with `in_code_review`
   - Replace `ready_for_qa` with `in_qa` (in "QA finds bugs" row)
   - Replace `ready_for_approval` with `in_approval`
   - Remove `in_qa` row (duplicate with corrected second row)

### Suggested Enhancements (Optional)

1. **Add workflow phase explanation:**
   ```markdown
   **Note:** Statuses follow a pattern:
   - `ready_for_X`: Waiting for X phase to begin (blocking state)
   - `in_X`: Actively working in X phase (active state)

   Rejection reasons are required when transitioning from an active state (`in_*`)
   back to an earlier phase.
   ```

2. **Create error message fix task:**
   - File: internal/repository/task_repository.go
   - Change "use --reason flag" to "use --rejection-reason flag"
   - Low priority, documentation-only issue

---

## Test Environment

- **Project Root:** /home/jwwelbor/projects/shark-task-manager
- **Shark Version:** (from ./bin/shark)
- **Config File:** .sharkconfig.json (workflow v1.0)
- **Database:** shark-tasks.db (SQLite)

---

## Files Reviewed

1. ✅ docs/CLI_REFERENCE.md
2. ✅ docs/cli-reference/rejection-reasons.md
3. ✅ docs/cli-reference/task-commands-full.md
4. ✅ docs/cli-reference/workflow-config.md
5. ✅ docs/cli-reference/error-messages.md
6. ✅ .sharkconfig.json (workflow configuration)
7. ✅ internal/repository/task_repository.go (error message verification)

---

## Next Steps

1. **Developer must fix** the backward transition table in rejection-reasons.md
2. **Re-submit for QA** after fixing status names
3. **Optional:** Create follow-up task for repository error message fix

---

## QA Sign-Off

**Result:** ❌ REJECTED - Must fix status names in backward transition table

**QA Agent:** qa-agent
**Date:** 2026-01-17 01:26:55
