---
key: T-E07-F22-021
title: Add rejection events to task timeline command
epic: E07
feature: E07-F22
agent: backend
status: todo
priority: 7
dependencies: [T-E07-F22-019]
created_at: 2026-01-16T06:37:39Z
estimated_time: 4 hours
---

# Task: Add rejection events to task timeline command

## Goal

Enhance `shark task timeline` command to display rejection events with warning symbols, inline reasons (truncated if long), and document indicators, providing chronological view of all task events including rejections.

## Success Criteria

- [ ] Timeline shows rejection events in chronological order
- [ ] Rejections highlighted with âš ï¸ warning symbol
- [ ] Reason text displayed inline (truncated if > 80 chars)
- [ ] Document indicator (ğŸ“„) shown when document linked
- [ ] Matches styling of other timeline events
- [ ] JSON mode includes rejection details

## Implementation Guidance

### Overview

The timeline command shows all task events chronologically. Rejections should be prominently displayed alongside other events (status changes, notes, etc.) to give developers full task history.

### Key Requirements

1. **Timeline Integration** - See [Feature PRD - REQ-F-006](../feature.md#requirements)
   - Query rejection notes alongside other events
   - Sort all events chronologically
   - Display rejections with distinct formatting

2. **Event Display** - See [Feature PRD - Terminal Output Mock](../feature.md#terminal-output-mock)
   - Symbol: âš ï¸ for rejection events
   - Show: timestamp, "Rejected by {agent}", status transition
   - Reason: Inline, truncated to 80 chars with "..." if longer
   - Document: Show ğŸ“„ symbol + path if present

3. **Reason Truncation**
   - Full reason > 80 chars: truncate and add "..."
   - User can see full reason in `shark task get` command
   - Truncation only in timeline (space-constrained view)

### Files to Create/Modify

**CLI Command**:
- `internal/cli/commands/task_timeline.go` - Add rejection event display
- If timeline command doesn't exist, document that it's a future enhancement

**Repository** (reuse from T-E07-F22-019):
- `internal/repository/task_note_repository.go` - GetRejectionHistory() already exists
- Timeline command will call this method

### Integration Points

- **GetRejectionHistory()** (T-E07-F22-019) - Fetch rejection events
- **Timeline Command** (existing or future) - Enhanced with rejection display
- **Other Timeline Events** (existing) - Rejections interleaved chronologically

## Validation Gates

**Timeline Display**:
- Rejection events appear in correct chronological position
- Warning symbol (âš ï¸) displays correctly
- Reason text truncated appropriately (80 char limit)
- Document indicator shown when applicable

**Event Formatting**:
- Consistent styling with other timeline events
- Colors work with --no-color flag
- Text readable in terminal width constraints

**JSON Output**:
- Rejection events included in timeline JSON
- Full reason text in JSON (no truncation)
- Document path included when present

## Context & Resources

**Feature Requirements**:
- [Feature PRD - REQ-F-006: Timeline Integration](../feature.md#requirements)
- [Feature PRD - Terminal Output Mock](../feature.md#terminal-output-mock)

**Existing Patterns**:
- Check if timeline command exists (may be future feature)
- Use GetRejectionHistory() from T-E07-F22-019
- Follow timeline event formatting if command exists

## Notes for Agent

- **Timeline Command**: Check if `shark task timeline` exists; if not, document as future enhancement
- **Truncation Logic**: len(reason) > 80 ? reason[:77] + "..." : reason
- **Symbol Display**: âš ï¸ and ğŸ“„ are Unicode; ensure terminal compatibility
- **Chronological Sort**: Mix rejections with other events, sort by timestamp
- **Testing**: Mock repository in CLI tests
