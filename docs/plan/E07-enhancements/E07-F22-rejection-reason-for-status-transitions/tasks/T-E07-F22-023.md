---
key: T-E07-F22-023
title: Implement rejection note filtering and search
epic: E07
feature: E07-F22
agent: backend
status: todo
priority: 9
dependencies: [T-E07-F22-019]
created_at: 2026-01-16T06:37:58Z
estimated_time: 5 hours
---

# Task: Implement rejection note filtering and search

## Goal

Add `shark task notes` command with --type=rejection flag, --search flag for text search, and time period filtering, enabling teams to search rejection reasons and identify quality trends.

## Success Criteria

- [ ] `shark task notes` command created (if doesn't exist)
- [ ] --type=rejection flag filters to rejection notes only
- [ ] --search flag performs text search on reason content
- [ ] --epic and --feature flags filter by scope
- [ ] --since and --until flags for time period filtering
- [ ] JSON output for programmatic analysis
- [ ] Query performance acceptable for 1000+ rejection notes

## Implementation Guidance

### Overview

Teams need to search rejection reasons to identify patterns (e.g., "missing error handling" appearing frequently). This command provides flexible querying of rejection notes across all tasks.

### Key Requirements

1. **Command Creation** - See [Feature PRD - REQ-F-008](../feature.md#requirements)
   - Create `shark task notes` command if doesn't exist
   - Default shows all notes; --type=rejection filters to rejections
   - Support multiple filter combinations

2. **Search Functionality** - See [Feature PRD - Story 5](../feature.md#user-stories)
   - --search performs case-insensitive LIKE query
   - Searches reason text content
   - Can combine with other filters

3. **Scope Filtering**
   - --epic filters to rejection notes in specific epic
   - --feature filters to rejection notes in specific feature
   - Efficient JOIN with tasks table

4. **Time Period Filtering**
   - --since filters notes after date
   - --until filters notes before date
   - Date format: YYYY-MM-DD

### Files to Create/Modify

**CLI Command**:
- `internal/cli/commands/task_notes.go` - Create notes command with filters
- May need to create new command file

**Repository**:
- `internal/repository/task_note_repository.go` - Add SearchRejectionNotes method
- Support multiple filter parameters
- Build SQL WHERE clause dynamically based on provided filters

### Integration Points

- **Task Notes Repository** (T-E07-F22-018) - Query rejection notes with filters
- **Tasks Table** (existing) - JOIN to filter by epic/feature
- **CLI Framework** (existing) - Register new command

## Validation Gates

**Search Functionality**:
- Text search works correctly (case-insensitive)
- --type=rejection filters to rejection notes only
- Scope filters (epic, feature) work correctly
- Time period filters work correctly

**Query Performance**:
- Search on 1000+ rejection notes < 500ms
- Uses index on (note_type, task_id)
- Efficient JOINs with tasks table

**Filter Combinations**:
- Multiple filters work together (AND logic)
- Empty results handled gracefully
- Query optimization for common filter patterns

**JSON Output**:
- Structured output for programmatic analysis
- Includes all relevant fields: task_key, timestamp, reason, rejector

## Context & Resources

**Feature Requirements**:
- [Feature PRD - REQ-F-008: Rejection Note Filtering](../feature.md#requirements)
- [Feature PRD - Story 5](../feature.md#user-stories)

**Existing Patterns**:
- Review other search/filter commands in CLI
- Follow dynamic WHERE clause patterns from other repositories
- Use existing date parsing utilities

## Notes for Agent

- **Command Registration**: Register with CLI framework init() function
- **SQL Injection**: Use parameterized queries for --search (never concatenate)
- **Dynamic WHERE**: Build WHERE clause based on which filters provided
- **Performance**: Test with large datasets; use EXPLAIN QUERY PLAN
- **Testing**: Mock repository in CLI tests; test query building logic separately
