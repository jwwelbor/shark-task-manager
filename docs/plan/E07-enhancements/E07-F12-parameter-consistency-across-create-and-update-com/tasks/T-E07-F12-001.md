---
agent: backend
created_at: 2026-01-01T07:35:47Z
epic: E07
feature: E07-F12
key: T-E07-F12-001
priority: 8
status: todo
task_key: T-E07-F12-010
title: Create shared_flags.go with flag registration functions
---


# Task: Create shared_flags.go with flag registration functions

## Goal

Create a shared module for flag registration that eliminates duplication across epic and feature commands. This module provides composable flag registration functions following the builder pattern.

## Related Documentation

- Implementation Plan: dev-artifacts/2026-01-01-parameter-consistency-research/implementation-plan.md (lines 26-116)
- Phase 1 Complete: dev-artifacts/2026-01-01-parameter-consistency-research/phase1-implementation-complete.md

## Implementation Details

### File to Create

- Location: internal/cli/commands/shared_flags.go

### API Design

Create the following types and functions:

```go
type FlagSet string

const (
    FlagSetMetadata       FlagSet = "metadata"      // --title, --description
    FlagSetPath           FlagSet = "path"          // --path, --filename, --force
    FlagSetEpicStatus     FlagSet = "epic_status"   // --status, --priority, --business-value
    FlagSetFeatureStatus  FlagSet = "feature_status" // --status
    FlagSetCustomKey      FlagSet = "custom_key"    // --key
)

// Primary API
func AddFlagSet(cmd *cobra.Command, flagSet FlagSet, opts ...FlagOption)

// Option types
type FlagOption func(*flagConfig)
func WithRequired(flagNames ...string) FlagOption
func WithDefaults(defaults map[string]interface{}) FlagOption

// Individual flag functions
func AddMetadataFlags(cmd *cobra.Command)
func AddPathFlags(cmd *cobra.Command)
func AddEpicStatusFlags(cmd *cobra.Command, defaults map[string]string)
func AddFeatureStatusFlags(cmd *cobra.Command, defaults map[string]string)
func AddCustomKeyFlag(cmd *cobra.Command)
```

### Implementation Strategy

1. Start with basic flag sets (metadata, path, custom_key)
2. Add status flag sets (epic_status, feature_status)
3. Implement option functions (WithRequired, WithDefaults)
4. Test each function independently
5. DO NOT modify epic.go or feature.go yet (that's Phase 3)

## Acceptance Criteria

- [ ] FlagSet constants defined
- [ ] AddFlagSet function works for all flag set types
- [ ] WithDefaults option correctly sets default values
- [ ] WithRequired option correctly marks flags as required
- [ ] Individual flag functions work independently
- [ ] Code follows existing Shark project patterns
- [ ] No changes to epic.go or feature.go

## Testing Requirements

### Unit Tests (shared_flags_test.go)

- [ ] TestAddFlagSet_Metadata - Verifies metadata flags registered
- [ ] TestAddFlagSet_Path - Verifies path flags registered
- [ ] TestAddFlagSet_EpicStatus - Verifies epic status flags registered
- [ ] TestAddFlagSet_FeatureStatus - Verifies feature status flags registered
- [ ] TestAddFlagSet_CustomKey - Verifies custom key flag registered
- [ ] TestAddFlagSet_WithDefaults - Verifies default values applied
- [ ] TestAddFlagSet_InvalidFlagSet - Verifies panic on invalid flag set

### Coverage Target

- 95%+ coverage for shared_flags.go

## Notes

- This is Phase 2 Task 1 of 5
- Creates foundation for DRY refactoring
- Must be completed before Phase 3 refactoring
- Follow TDD: write tests first, then implementation
- All tests should use mocked Cobra commands (no real CLI execution)
