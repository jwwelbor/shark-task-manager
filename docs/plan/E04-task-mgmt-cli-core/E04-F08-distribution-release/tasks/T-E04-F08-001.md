---
task_key: T-E04-F08-001
status: created
feature: /docs/plan/E04-task-mgmt-cli-core/E04-F08-distribution-release
created: 2025-12-17
assigned_agent: devops-engineer
dependencies: []
estimated_time: 6 hours
---

# Task: Version Management & GoReleaser Setup

## Goal

Configure version embedding in the Shark CLI binary and set up GoReleaser for local multi-platform builds, establishing the foundation for automated release workflows.

## Success Criteria

- [ ] Version variable added to `cmd/shark/main.go` with build-time injection
- [ ] `shark --version` command displays correct version
- [ ] `.goreleaser.yml` configuration created and validated
- [ ] Snapshot build completes successfully for all 5 platforms
- [ ] Local build completes in <6 minutes
- [ ] All binaries are <12 MB compressed
- [ ] Performance baseline metrics documented

## Implementation Guidance

### Overview

Add version management to the Shark CLI and create GoReleaser configuration to build binaries for Linux (amd64, arm64), macOS (amd64, arm64), and Windows (amd64). This phase focuses on local testing before CI/CD integration.

### Key Requirements

- **Version Embedding**: Implement version variable that can be set via `-ldflags` at build time - See [Architecture - Version Management](../02-architecture.md#version-management)
- **GoReleaser Config**: Create comprehensive `.goreleaser.yml` with build targets, archives, and checksums - See [Architecture - GoReleaser Configuration](../02-architecture.md#goreleaser-configuration)
- **Cross-Platform Builds**: Configure for 5 platform combinations (Linux amd64/arm64, macOS amd64/arm64, Windows amd64) - See [Architecture - Build Targets](../02-architecture.md#build-targets)
- **Binary Optimization**: Use `-s -w` ldflags to strip debug symbols and reduce binary size - See [Performance - Binary Size Optimization](../07-performance-design.md#binary-size-optimization)
- **Local Validation**: Test snapshot builds locally before CI/CD setup

### Files to Create/Modify

**Go Code**:
- `cmd/shark/main.go` - Add version variable and `--version` flag support

**Configuration**:
- `.goreleaser.yml` - Complete GoReleaser configuration at repository root

**Documentation**:
- `docs/release-baseline-metrics.md` - Document performance baselines

### Integration Points

- **Cobra CLI Framework**: Integrate version flag into existing Cobra command structure
- **Build System**: Ensure GoReleaser works with existing Go module structure
- **Future CI/CD**: Configuration must work in GitHub Actions environment (Phase 2)

Reference: [Architecture - Integration Points](../02-architecture.md#integration-points)

## Validation Gates

**Configuration Validation**:
- Run `goreleaser check` - must pass with no errors or warnings
- Verify all 5 platforms configured correctly
- Confirm archive formats (.tar.gz for Unix, .zip for Windows)

**Build Validation**:
- Execute `goreleaser build --snapshot --clean`
- Verify 5 binaries generated in `dist/` directory
- Test each binary: `./dist/shark_*/shark --version`
- Confirm version shows "dev" or snapshot identifier (not blank)

**Performance Validation**:
- Measure total build time (target: <6 minutes)
- Measure individual platform build times
- Check compressed binary sizes (target: <12 MB each)
- Document baseline metrics for comparison

**Checksum Validation**:
- Verify `dist/checksums.txt` generated
- Run `sha256sum -c checksums.txt` in dist/ directory
- Confirm all checksums match

Reference: [Test Criteria - Phase 1 Tests](../09-test-criteria.md#phase-1-version-management--local-testing)

## Context & Resources

- **Architecture**: [GoReleaser Configuration](../02-architecture.md#goreleaser-configuration)
- **Architecture**: [Build Process](../02-architecture.md#build-process)
- **Architecture**: [Version Management](../02-architecture.md#version-management)
- **Performance**: [Binary Size Targets](../07-performance-design.md#binary-size-targets)
- **Performance**: [Build Time Optimization](../07-performance-design.md#build-time-optimization)
- **Implementation**: [Phase 1 Tasks](../08-implementation-phases.md#phase-1-version-management--local-testing)
- **Testing**: [Configuration Tests](../09-test-criteria.md#configuration-validation)

## Notes for Agent

- **GoReleaser Installation**: Install GoReleaser locally via Homebrew (`brew install goreleaser`) or download from releases
- **Go Version**: Ensure Go 1.23+ is available (check existing Shark requirements)
- **ldflags Pattern**: Use `-ldflags "-X main.Version={{.Version}} -s -w"` for version injection and size optimization
- **Archive Contents**: Include binary, README.md, and LICENSE in archives (configure in `.goreleaser.yml`)
- **Comments**: Add detailed comments in `.goreleaser.yml` explaining each section for future maintainers
- **Snapshot Mode**: Use `--snapshot` flag for local testing (skips Git tag validation)
- **Performance Baseline**: Document actual timings and sizes for tracking improvements
