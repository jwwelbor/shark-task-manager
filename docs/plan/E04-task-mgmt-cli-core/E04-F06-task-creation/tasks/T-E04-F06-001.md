---
task_key: T-E04-F06-001
status: todo
feature: /home/jwwelbor/.claude/docs/plan/E04-task-mgmt-cli-core/E04-F06-task-creation
created: 2025-12-14
assigned_agent: general-purpose
dependencies: ["T-E04-F01-006", "T-E04-F05-001"]
estimated_time: 6 hours
file_path: /home/jwwelbor/.claude/docs/tasks/todo/T-E04-F06-001.md
---

# Task: Template System Implementation

## Goal

Implement a Go text/template-based template system for generating agent-specific task markdown files with proper frontmatter, customizable structure, and graceful handling of optional fields.

## Success Criteria

- [ ] Go text/template engine configured and integrated
- [ ] Six default agent templates created (frontend, backend, api, testing, devops, general)
- [ ] All templates include complete frontmatter block with YAML format
- [ ] Templates have agent-specific structure sections
- [ ] Template rendering handles missing optional fields gracefully (no "Description:" when empty)
- [ ] Template variables properly injected (key, title, description, epic, feature, agent_type, priority, depends_on, created_at)
- [ ] Templates generate well-formatted markdown with consistent indentation
- [ ] Template location configurable (default: `templates/task-{agent-type}.md`)
- [ ] All templates validated to ensure no rendering errors with sample data

## Implementation Guidance

### Overview

This task establishes the template system that generates task markdown files. Each agent type needs a specialized template with appropriate structure. The templates must produce consistent, well-formatted markdown files that include all required metadata in frontmatter and provide agent-specific boilerplate content.

### Key Requirements

- **Template Structure**: Each template must include per [PRD - Template System Requirements](../prd.md#template-system)
  - YAML frontmatter block with all metadata fields
  - Agent-specific content structure:
    - Frontend: Component specs, UI/UX notes, acceptance criteria
    - Backend: API endpoints, data models, business logic
    - API: Endpoint specs, request/response examples, error codes
    - Testing: Test scenarios, test data, coverage requirements
    - DevOps: Deployment configs, infrastructure specs, monitoring
    - General: Flexible structure for any task type

- **Template Variables**: Templates receive per [PRD - Template Requirements 21](../prd.md#functional-requirements)
  - `key` (e.g., "T-E01-F02-003")
  - `title` (user-provided string)
  - `description` (optional, empty string if not provided)
  - `epic` (e.g., "E01")
  - `feature` (e.g., "E01-F02")
  - `agent_type` (enum: frontend, backend, api, testing, devops, general)
  - `priority` (1-10, default 5)
  - `depends_on` (array of task keys, can be empty)
  - `created_at` (ISO 8601 timestamp)

- **Frontmatter Format**: All templates must generate per [PRD - Requirement 22](../prd.md#functional-requirements)
  ```yaml
  ---
  key: T-E01-F02-003
  title: Build authentication middleware
  epic: E01
  feature: E01-F02
  agent: backend
  status: todo
  priority: 5
  depends_on: [T-E01-F01-005]
  created_at: 2025-12-14T10:30:00Z
  ---
  ```

- **Optional Field Handling**: Per [PRD - Requirement 24](../prd.md#functional-requirements)
  - Don't render "Description:" section if description is empty
  - Don't render "Dependencies:" section if depends_on is empty
  - Use Go template conditionals (`{{if .Description}}`) to show/hide sections

- **Template Discovery**: Templates should be located per [PRD - Requirement 20](../prd.md#functional-requirements)
  - Default location: `templates/task-{agent-type}.md`
  - Allow custom template path override (future extensibility)

### Files to Create/Modify

**New Files**:
- `internal/templates/renderer.go` - Go template renderer package (~200 lines)
- `internal/templates/loader.go` - Template loading utilities (~100 lines)
- `templates/task-frontend.md` - Frontend agent template
- `templates/task-backend.md` - Backend agent template
- `templates/task-api.md` - API developer agent template
- `templates/task-testing.md` - Testing agent template
- `templates/task-devops.md` - DevOps agent template
- `templates/task-general.md` - General-purpose agent template
- `internal/templates/renderer_test.go` - Template rendering tests (~250 lines)

**Modified Files**:
- `cmd/pm/main.go` - Initialize template system

### Integration Points

- **Database Models (E04-F01)**: Template variables will come from Task model fields
- **Folder Management (E04-F05)**: Rendered templates will be saved using folder utilities
- **CLI Framework (E04-F02)**: CLI command will invoke template renderer
- **Task Creation Command (T-E04-F06-003)**: Will use template renderer to generate task files

### Template Design Patterns

**Frontend Template Structure**:
- Component specifications section
- UI/UX design notes
- State management requirements
- Acceptance criteria checklist
- Testing requirements (component tests)

**Backend Template Structure**:
- API endpoint definitions
- Data model specifications
- Business logic requirements
- Database interaction notes
- Error handling requirements
- Testing requirements (unit + integration)

**API Template Structure**:
- Endpoint specification (method, path, params)
- Request body schema
- Response schema examples
- Error codes and messages
- Authentication/authorization requirements
- Rate limiting notes

**Testing Template Structure**:
- Test scenarios (positive/negative/edge cases)
- Test data requirements
- Coverage targets
- Performance benchmarks
- Integration test requirements

## Validation Gates

- **Template Rendering**: Test template rendering with [PRD - Acceptance Criteria](../prd.md#template-application)
  - Render each template with sample data
  - Verify frontmatter YAML is valid
  - Verify optional fields hidden when empty
  - Verify agent-specific sections present

- **Frontmatter Validation**: Per [PRD - Frontmatter Generation](../prd.md#frontmatter-generation)
  - Parse generated frontmatter with PyYAML
  - Verify all required fields present
  - Verify field values match input variables
  - Verify YAML structure is valid

- **Unit Tests**: All template renderer tests passing
  - Test rendering with full metadata
  - Test rendering with minimal metadata (only required fields)
  - Test rendering with empty description (section hidden)
  - Test rendering with empty depends_on (section hidden)
  - Test rendering with all 6 agent types
  - Test invalid template path handling

- **Markdown Quality**: Generated markdown meets standards
  - Consistent indentation (2 or 4 spaces)
  - Unix line endings (LF)
  - No trailing whitespace
  - Proper heading hierarchy (# → ## → ###)

## Context & Resources

- **PRD**: [Task Creation & Templating PRD](../prd.md)
  - [Template System Requirements](../prd.md#template-system)
  - [Functional Requirements 19-24](../prd.md#functional-requirements)
  - [Acceptance Criteria - Template Application](../prd.md#template-application)
  - [Acceptance Criteria - Frontmatter Generation](../prd.md#frontmatter-generation)
- **Epic**: [E04 Task Management CLI](../../epic.md)

## Notes for Agent

- **Go Template Configuration**: Use `text/template` package from Go standard library. Configure with custom functions for formatting (e.g., `funcMap` for join operations on arrays).
- **Template Location**: Store templates in `templates/` directory at project root. Use `embed` package to embed templates in the binary, or load from filesystem using `os.ReadFile`.
- **Frontmatter YAML**: Use `gopkg.in/yaml.v3` to validate generated frontmatter structure. Ensure arrays render as `[item1, item2]` not multi-line format (use flow style).
- **Agent Type Mapping**: Create constant mapping (map[string]string or const declarations) of agent types to template file names for easy lookup.
- **Error Handling**: Return descriptive errors using `fmt.Errorf` with context if template file not found or rendering fails. Include template name and variable values in error message.
- **Template Comments**: Add header comment to each template explaining available variables and purpose using Go template comment syntax `{{/* comment */}}`.
- **Template Data Structure**: Create a struct (e.g., `TemplateData`) with all template variables as fields. Use struct tags for clarity.
- **Template Functions**: Add custom template functions for: joining arrays with commas, checking if string is empty, formatting timestamps.
- **Markdown Formatting**: Use consistent heading levels and bullet formatting across all templates. Reference existing task files (T-E04-F01-*.md) for formatting style.
- **Testing Strategy**: Create comprehensive test fixtures with various combinations of optional fields using table-driven tests. Test edge cases like very long descriptions, special characters in title, large dependency arrays.
- **Go Conventions**: Use proper Go package structure (`internal/templates/`), follow Go naming conventions (e.g., `RenderTemplate` not `render_template`), use Go error handling patterns.
