---
status: created
feature: /docs/plan/E04-task-mgmt-cli-core/E04-F07-initialization-sync
created: 2025-12-16
assigned_agent: api-developer
dependencies: []
estimated_time: 8 hours
---

# Task: File Scanner and Parser Implementation

## Goal

Implement file scanning and frontmatter parsing to discover task markdown files, extract metadata, and infer epic/feature keys from directory structure for the sync engine.

## Success Criteria

- [ ] FileScanner recursively discovers all T-*.md files in directory tree
- [ ] Epic and feature keys correctly inferred from folder structure
- [ ] File metadata extracted (path, modified time, epic, feature)
- [ ] Legacy folder structure supported (docs/tasks/*)
- [ ] File path validation prevents directory traversal
- [ ] File size limits enforced (reject files >1MB)
- [ ] Symlink handling validated or disabled
- [ ] Scanner processes 100 files in <1 second
- [ ] All validation gates pass

## Implementation Guidance

### Overview

Create the file scanning component within the `internal/sync` package. The scanner walks the directory tree, filters task files by pattern, and infers epic/feature context from the parent directory structure. Security validations prevent malicious file paths.

### Key Requirements

- Implement recursive file scanning with filepath.Walk - See [Architecture - FileScanner](../02-architecture.md#filescanner)
- Pattern matching for T-E##-F##-###.md files - See [Contract - FileScanner Interface](../01-interface-contracts.md#filescanner-interface)
- Infer epic/feature from directory names - See [Architecture - Inference Strategy](../02-architecture.md#filescanner)
- Validate file paths to prevent traversal attacks - See [Security Design - File Path Validation](../06-security-design.md#file-path-validation)
- Enforce file size limits (DoS prevention) - See [Security Design - File Limits](../06-security-design.md#file-limits)

### Files to Create/Modify

**Backend**:
- `internal/sync/scanner.go` - FileScanner implementation
- `internal/sync/types.go` - TaskFileInfo struct
- `internal/sync/scanner_test.go` - Unit tests for scanner
- `internal/sync/scanner_integration_test.go` - Integration tests with real filesystem

### Integration Points

- SyncEngine will use scanner as first step
- Output feeds into file parsing and database query phases
- Works with both feature-based and legacy folder structures

Reference: [Architecture - FileScanner Component](../02-architecture.md#filescanner)

## Validation Gates

**Linting & Type Checking**:
- Go code passes all linters
- No security warnings from static analysis

**Unit Tests**:
- Recursive traversal discovers nested files
- Pattern matching correctly filters T-*.md files
- Epic/feature inference works for standard structure (docs/plan/E##-epic/E##-F##-feature/)
- Legacy structure inference works (docs/tasks/todo/)
- Path validation rejects ../.. traversal attempts
- File size limit rejects files >1MB
- Symlink handling tested (follow or reject based on security policy)

**Integration Tests**:
- Scanner works with real directory structure
- Handles file permissions errors gracefully
- Large directory trees (>100 files) processed efficiently

**Performance Tests**:
- Scanner processes 100 files in <1 second

## Context & Resources

- **Architecture**: [FileScanner Component](../02-architecture.md#filescanner)
- **Contracts**: [FileScanner Interface](../01-interface-contracts.md#filescanner-interface)
- **Backend Design**: [scanner.go](../04-backend-design.md#scannergo)
- **Security Design**: [File Path Validation](../06-security-design.md#file-path-validation)
- **Implementation Phases**: [Phase 3](../08-implementation-phases.md#phase-3-file-scanning--parsing)

## Notes for Agent

- Use filepath.Walk (standard library, efficient for most use cases)
- Compile regex pattern once (outside loop): `regexp.MustCompile(^T-E\\d{2}-F\\d{2}-\\d{3}\\.md$)`
- Inference algorithm: parent dir → feature key, grandparent → epic key
- Convert all paths to absolute for security validation
- Use filepath.Clean to normalize paths before validation
- Log warnings for files that can't be read (permissions) but continue
- Consider os.FileInfo.Mode() for permission checks
- Return empty epic/feature keys if inference fails (sync will handle)
