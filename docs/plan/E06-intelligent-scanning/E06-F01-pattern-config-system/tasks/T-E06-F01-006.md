---
task_key: T-E06-F01-006
status: todo
feature: /docs/plan/E06-intelligent-scanning/E06-F01-pattern-config-system
created: 2025-12-17
assigned_agent: backend
dependencies: []
estimated_time: 8 hours
---

# Task: Implement First-Match-Wins Pattern Ordering & Integration Tests

---

## Goal

Implement pattern evaluation logic with first-match-wins semantics, compile-time caching, and comprehensive integration tests to verify the complete pattern configuration system works end-to-end.

## What to Build

Complete the pattern matching engine with performance optimizations and verify the entire F01 feature through integration testing.

**Core Components**:

1. **First-Match-Wins Pattern Evaluation**:
   - Evaluate patterns in configured array order
   - Use first matching pattern (short-circuit, don't evaluate remaining)
   - Log which pattern matched each file in verbose mode
   - Track unmatched files with list of attempted patterns
   - Example: Given patterns `["E(?P<number>\d{2})-(?P<slug>.+)", "(?P<epic_id>tech-debt|bugs)"]`, folder `E04-task-mgmt` matches first pattern and second pattern is never evaluated

2. **Pattern Compilation Caching**:
   - Compile regex patterns once at config load (not per-file)
   - Cache compiled regexes for reuse during scanning operations
   - Pattern matching overhead <1ms per file for typical pattern sets (3-5 patterns per entity type)
   - First-match evaluation short-circuits after first match

3. **Pattern Matching Efficiency** (REQ-NFR-002):
   - Cached compiled patterns reused during scan
   - Short-circuit evaluation stops after first match
   - Pattern matching overhead <1ms per file

4. **Integration Tests**:
   - Test complete workflow: config load → pattern validation → pattern matching → generation format application
   - Test all default patterns match expected filenames
   - Test preset addition workflow
   - Test pattern testing commands
   - Test generation format application for epic/feature/task creation
   - Test first-match-wins with multiple patterns
   - Test error handling for invalid configs
   - Achieve >90% code coverage for pattern matching logic

5. **Error Handling Edge Cases**:
   - Corrupted config file handling (invalid JSON)
   - Regex DoS pattern rejection
   - Pattern matching timeout (100ms per match)
   - Clock skew handling (±5 seconds)

## Why This Matters

First-match-wins ordering enables progressive fallback from strict to flexible patterns, allowing users to prioritize standard conventions while still accepting variations. Integration tests ensure the entire feature works cohesively and catches regressions.

## Success Criteria

- [ ] Pattern evaluation follows array order with first-match-wins
- [ ] Short-circuit evaluation skips remaining patterns after match
- [ ] Verbose mode logs which pattern matched each file
- [ ] Unmatched files list attempted patterns
- [ ] Pattern compilation caching implemented
- [ ] Pattern matching overhead <1ms per file
- [ ] Integration tests cover complete workflows
- [ ] >90% code coverage for pattern matching logic
- [ ] All acceptance criteria from PRD passing
- [ ] Error handling for corrupted config, DoS patterns, timeouts

## Reference Documents

- **PRD**: `/docs/plan/E06-intelligent-scanning/E06-F01-pattern-config-system/prd.md`
  - NFR-001 (Pattern Validation Speed), NFR-002 (Pattern Matching Efficiency)
  - NFR-011 (Test Coverage)
  - Acceptance Criteria: AC-025, AC-026, AC-027, AC-028, AC-029, AC-030

## Dependencies

- T-E06-F01-001 (Pattern Configuration Schema)
- T-E06-F01-002 (Pattern Validation Engine)
- T-E06-F01-003 (Pattern Preset Library)
- T-E06-F01-004 (Pattern Testing Commands)
- T-E06-F01-005 (Generation Format Application)

All previous tasks must be complete to test end-to-end integration.

## Validation

1. Test first pattern matches and second pattern never evaluated
2. Test second pattern matches after first fails
3. Test no patterns match and folder skipped with warning
4. Test pattern compilation caching (compile once, reuse many times)
5. Test pattern matching completes in <1ms per file
6. Run integration tests for complete workflows
7. Verify >90% code coverage
8. Test corrupted config file handling
9. Test regex DoS pattern rejection
10. Test pattern matching timeout

## Estimated Complexity

**High** - Integration testing across all components with performance optimization and edge case handling

---

**Status**: created
**Created**: 2025-12-17
