---
task_key: T-E06-F01-005
status: todo
feature: /docs/plan/E06-intelligent-scanning/E06-F01-pattern-config-system
created: 2025-12-17
assigned_agent: backend
dependencies: []
estimated_time: 8 hours
---

# Task: Implement Generation Format Application

---

## Goal

Implement generation format template parsing and application for creating new epic/feature/task folders and files with standardized naming while sanitizing user input to prevent security vulnerabilities.

## What to Build

Create a template engine that applies generation format templates when creating new items via CLI, ensuring consistent naming conventions while preventing path traversal attacks.

**Core Components**:

1. **Template Placeholder Syntax**:
   - `{number}` - unformatted number (1, 2, 3)
   - `{number:02d}` - zero-padded 2-digit number (01, 02, 03)
   - `{slug}` - user-provided slug value
   - `{epic}` or `{epic:02d}` - parent epic number
   - `{feature}` or `{feature:02d}` - parent feature number
   - Parse template string and extract placeholders with formatting options

2. **Template Application**:
   - Apply generation format when creating new items via `shark epic create`, `shark feature create`, `shark task create`
   - Auto-increment number based on existing entities (query database for max number)
   - Substitute placeholders with actual values
   - Default generation formats:
     - Epic: `E{number:02d}-{slug}`
     - Feature: `E{epic:02d}-F{number:02d}-{slug}`
     - Task: `T-E{epic:02d}-F{feature:02d}-{number:03d}.md`

3. **Slug Value Sanitization**:
   - Reject slug values containing forbidden characters: `/`, `\`, `..`, `:`, etc.
   - Generate path and validate it remains within project boundaries
   - Error message lists forbidden characters
   - Example error: "Invalid slug: contains forbidden characters. Forbidden: /, \, .., :"
   - No file or database record created if validation fails

4. **Path Injection Prevention**:
   - Sanitize generation format placeholders to prevent directory traversal
   - Validate generated file paths remain within project boundaries
   - Reject slug values containing filesystem special characters
   - Use NFR-004 (Path Injection Prevention) security requirements

## Why This Matters

Generation format application ensures new items follow team conventions while accepting flexible input during import. This separation (flexible sync acceptance vs. standardized generation) is critical for maintaining documentation consistency while supporting varied existing patterns.

## Success Criteria

- [ ] Template placeholder syntax parsed correctly with formatting options
- [ ] Generation format applied when creating new epics, features, tasks
- [ ] Auto-increment number queried from database (max + 1)
- [ ] Default generation formats produce correct folder/file names
- [ ] Slug values sanitized to prevent path traversal
- [ ] Generated paths validated to remain within project boundaries
- [ ] Forbidden characters in slug rejected with clear error
- [ ] No file or database record created if validation fails

## Reference Documents

- **PRD**: `/docs/plan/E06-intelligent-scanning/E06-F01-pattern-config-system/prd.md`
  - Requirements: FR-004 (Generation Format Templates)
  - NFR-004 (Path Injection Prevention)
  - Acceptance Criteria: AC-021, AC-022, AC-023, AC-024

## Dependencies

- T-E06-F01-001 (Pattern Configuration Schema)

## Validation

1. Test epic generation format: `E{number:02d}-{slug}` produces `E05-identity-platform`
2. Test feature generation format: `E{epic:02d}-F{number:02d}-{slug}` produces `E04-F08-oauth-integration`
3. Test task generation format: `T-E{epic:02d}-F{feature:02d}-{number:03d}.md` produces `T-E04-F07-007.md`
4. Test slug sanitization rejects `../malicious` with error
5. Test slug sanitization rejects `/path/injection` with error
6. Test auto-increment queries database for next number
7. Verify path validation prevents directory traversal

## Estimated Complexity

**Medium** - Template parsing, placeholder substitution, path sanitization, and validation logic

---

**Status**: created
**Created**: 2025-12-17
