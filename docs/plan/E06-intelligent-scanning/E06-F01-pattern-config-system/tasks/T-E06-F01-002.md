---
task_key: T-E06-F01-002
status: todo
feature: /docs/plan/E06-intelligent-scanning/E06-F01-pattern-config-system
created: 2025-12-17
assigned_agent: backend
dependencies: []
estimated_time: 8 hours
---

# Task: Implement Pattern Validation Engine

---

## Goal

Implement comprehensive pattern validation that checks regex syntax, required capture groups, and capture group names when loading `.sharkconfig.json`, providing actionable error messages for invalid patterns.

## What to Build

Create a validation engine that validates all patterns on config load to catch errors before scan operations, preventing invalid patterns from causing scan failures.

**Core Components**:

1. **Regex Syntax Validation**:
   - Validate regex syntax using Go's `regexp.Compile`
   - Detect invalid regex with clear error messages including pattern name and compiler error
   - Example error: "Invalid epic folder pattern 'E\\d{2-[a-z]+': missing closing brace in repetition operator"

2. **Required Capture Group Validation**:
   - Epic patterns must include at least one of: `epic_id`, `epic_slug`, `number`
   - Feature patterns must include (`epic_id` OR `epic_num`) AND (`feature_id` OR `feature_slug` OR `number`)
   - Task patterns must include (`epic_id` OR `epic_num`) AND (`feature_id` OR `feature_num`) AND (`task_id` OR `number` OR `task_slug`)
   - Produce errors listing pattern name, pattern string, required groups, and found groups

3. **Capture Group Name Validation**:
   - Validate capture group names match expected set (epic_id, epic_slug, epic_num, feature_id, feature_slug, feature_num, task_id, task_slug, task_num, number, slug)
   - Warn about unrecognized capture group names (not error) with typo suggestions
   - Example warning: "Pattern contains capture group 'feature_number' which will be ignored. Did you mean 'feature_num' or 'number'?"

4. **Validation Bypass**:
   - Support `--skip-pattern-validation` flag for advanced users
   - Log warning when validation skipped (use at own risk)

5. **Catastrophic Backtracking Detection**:
   - Detect excessive nested quantifiers (e.g., `(a+)+b`)
   - Warn about performance risks for unbounded alternation
   - Reject patterns with catastrophic backtracking potential

## Why This Matters

Pattern validation prevents users from discovering configuration errors during scan operations (after processing hundreds of files). Catching errors at config load time with actionable messages saves significant debugging time and prevents failed imports.

## Success Criteria

- [ ] Valid regex patterns pass validation without errors
- [ ] Invalid regex syntax produces error with pattern name and syntax problem
- [ ] Missing required capture groups produce errors with specific missing groups
- [ ] Unrecognized capture group names produce warnings with suggestions
- [ ] `--skip-pattern-validation` flag bypasses validation with warning logged
- [ ] Catastrophic backtracking patterns rejected with performance warning
- [ ] Validation time <100ms for typical configuration (15-20 patterns)

## Reference Documents

- **PRD**: `/docs/plan/E06-intelligent-scanning/E06-F01-pattern-config-system/prd.md`
  - Requirements: FR-005 (Config Load Validation), FR-006 (Regex Syntax), FR-007 (Required Capture Groups), FR-008 (Capture Group Name Validation)
  - NFR-003 (Regex DoS Protection)
  - Acceptance Criteria: AC-003, AC-004, AC-005, AC-006, AC-007, AC-029

## Dependencies

- T-E06-F01-001 (Pattern Configuration Schema) must be completed first

## Validation

1. Test valid pattern passes validation
2. Test invalid regex syntax produces error
3. Test missing required capture groups produces error
4. Test unrecognized capture group name produces warning
5. Test `--skip-pattern-validation` bypasses validation
6. Test catastrophic backtracking detection
7. Verify validation completes in <100ms for 20 patterns

## Estimated Complexity

**Medium** - Regex validation logic with capture group extraction and error reporting

---

**Status**: created
**Created**: 2025-12-17
