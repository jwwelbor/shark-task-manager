---
task_key: T-E06-F01-001
status: todo
feature: /docs/plan/E06-intelligent-scanning/E06-F01-pattern-config-system
created: 2025-12-17
assigned_agent: backend
dependencies: []
estimated_time: 8 hours
---

# Task: Implement Pattern Configuration Schema & Storage

---

## Goal

Implement the configuration schema for storing regex patterns in `.sharkconfig.json` with support for epic, feature, and task patterns including folder/file patterns and generation format templates.

## What to Build

Create the configuration schema and storage mechanism that enables users to define custom regex patterns for epic/feature/task discovery while maintaining backward compatibility with existing configurations.

**Core Components**:

1. **Configuration Schema Definition**:
   - Define JSON schema for `patterns` object with epic/feature/task sections
   - Each entity type supports `folder` patterns (array), `file` patterns (array), and `generation` format (object)
   - Pattern arrays evaluated in order with first-match-wins semantics
   - Generation format is single template string with placeholder syntax

2. **Default Pattern Definitions**:
   - Epic folder patterns: `E\d{2}-[a-z0-9-]+` (standard), `tech-debt|bugs|change-cards` (special types)
   - Feature folder patterns: `E\d{2}-F\d{2}-[a-z0-9-]+` (standard)
   - Feature file patterns: `prd\.md` (priority), `PRD_F\d{2}-.+\.md`, `[a-z0-9-]+\.md` (fallback)
   - Task file patterns: `T-E\d{2}-F\d{2}-\d{3}.*\.md` (full key), `\d{3}-.+\.md` (number-based), `.+\.prp\.md` (legacy)
   - All patterns include named capture groups for required fields

3. **Configuration Loading**:
   - Read patterns from `.sharkconfig.json` on initialization
   - Fall back to default patterns if user config doesn't specify patterns
   - Merge user patterns with defaults (user patterns take precedence)
   - Handle missing or corrupted config gracefully

4. **Named Capture Group Support**:
   - Epic patterns: `epic_id`, `epic_slug`, `number`
   - Feature patterns: `epic_id`, `epic_num`, `feature_id`, `feature_slug`, `number`
   - Task patterns: `epic_id`, `epic_num`, `feature_id`, `feature_num`, `task_id`, `task_slug`, `number`
   - Extract captured values for database key construction

## Why This Matters

This is the foundation for the entire intelligent scanning system. Without configurable patterns, shark remains rigid and cannot adapt to real-world documentation conventions. This task enables 90% of projects to work with default patterns while allowing customization for the remaining 10%.

## Success Criteria

- [ ] `.sharkconfig.json` schema includes `patterns` object with epic/feature/task sections
- [ ] Default patterns shipped for all entity types with correct named capture groups
- [ ] Configuration loading supports fallback to defaults when patterns not specified
- [ ] Pattern arrays evaluated in order (first match wins)
- [ ] Named capture groups extracted correctly from pattern matches
- [ ] Backward compatibility maintained with existing configs (no breaking changes)

## Reference Documents

- **PRD**: `/docs/plan/E06-intelligent-scanning/E06-F01-pattern-config-system/prd.md`
  - Requirements: FR-001 (Regex Pattern Storage), FR-002 (Named Capture Groups), FR-003 (Default Patterns)
  - Acceptance Criteria: AC-001, AC-002

## Dependencies

None - this is a foundational task

## Validation

1. Create new `.sharkconfig.json` with default patterns
2. Verify epic/feature/task pattern arrays are present
3. Verify generation format templates are present
4. Test pattern loading with valid config
5. Test fallback behavior with missing config
6. Verify named capture groups match requirements

## Estimated Complexity

**Medium** - Schema definition and configuration loading logic with fallback handling

---

**Status**: created
**Created**: 2025-12-17
