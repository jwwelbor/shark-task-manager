---
task_key: T-E06-F05-001
status: todo
feature: /docs/plan/E06-intelligent-scanning/E06-F05-import-reporting-validation
created: 2025-12-17
assigned_agent: backend
dependencies: []
estimated_time: 8 hours
---

# Task: Comprehensive Scan Report Generation

## Goal

Implement detailed scan report generation that shows files scanned/matched/skipped with breakdown by type (epics, features, tasks, related docs), includes actionable error messages for each skipped file with file path, reason, and suggested fix, and supports both human-readable CLI output and structured JSON format.

## Success Criteria

- [ ] ScanReport struct captures: total scanned, matched, skipped, breakdown by entity type
- [ ] SkippedFileEntry includes: file path, skip reason, suggested fix
- [ ] Error grouping: frontmatter errors, pattern mismatches, validation failures
- [ ] CLI output format: clear visual hierarchy with sections and indentation
- [ ] JSON output format: documented schema with versioning
- [ ] Scan metadata: timestamp, duration, validation level, patterns applied
- [ ] Unit tests for report generation and formatting
- [ ] Integration test: scan with errors generates complete report

## Implementation Guidance

### Overview

Create `internal/reporting/scan_report.go` that collects scan results throughout the sync workflow, formats them for output, and provides both CLI and JSON output modes. The report builder pattern allows components to add results incrementally (file scanned, file matched, file skipped with reason).

### Key Requirements

- **Scan Result Summary**: Total files scanned, matched, skipped by type - See [PRD - FR-001 through FR-003](../prd.md#report-generation)
- **Skipped File Details**: Absolute path, reason, suggested fix for each - See [PRD - FR-002](../prd.md#report-generation)
- **Error Grouping**: Group by type for efficient scanning - See [PRD - FR-009](../prd.md#error-messages)
- **JSON Schema**: Versioned, documented schema - See [PRD - FR-015 through FR-017](../prd.md#json-output)
- **Actionable Errors**: Follow format: file path + issue + suggestion - See [PRD - FR-005 through FR-008](../prd.md#error-messages)

### Files to Create/Modify

**New Files**:
- `internal/reporting/scan_report.go` - ScanReport builder and formatters
- `internal/reporting/scan_report_test.go` - Report generation tests
- `internal/reporting/formatters.go` - CLI and JSON formatters
- `internal/reporting/schema.go` - JSON schema definition

**Modified Files**:
- `internal/sync/engine.go` - Collect results and generate report
- `cmd/shark/commands/sync.go` - Add --output=json flag

### Validation Gates

- [ ] Scan 100 files (80 matched, 20 skipped): report shows correct counts
- [ ] Breakdown by type: 10 epics, 35 features, 35 tasks reported separately
- [ ] Skipped file entry: includes absolute path, reason, suggested fix
- [ ] Error grouping: 5 frontmatter errors grouped together
- [ ] CLI output: clear sections, indented lists, readable formatting
- [ ] JSON output: valid JSON, matches documented schema, includes version field
- [ ] Scan metadata: timestamp, duration (with 1 decimal precision)
- [ ] Report generation <5% overhead: 100-file scan + report in <2.1s (vs 2.0s)

### Integration Points

- **Sync Engine**: Calls report builder methods throughout scan workflow
- **Pattern Matching**: Reports pattern match successes and failures
- **Metadata Extraction**: Reports extraction warnings
- **Validation**: Reports validation errors with details

### Notes for Agent

- Use builder pattern: report.AddScanned(), report.AddMatched(), report.AddSkipped()
- CLI output: consider using color for errors (red), warnings (yellow), success (green)
- Respect --no-color flag for CI environments
- JSON schema version: use semver (1.0.0), bump on breaking changes
- Absolute paths in errors should be clickable in modern terminals
- Group errors but preserve order within groups (chronological)
