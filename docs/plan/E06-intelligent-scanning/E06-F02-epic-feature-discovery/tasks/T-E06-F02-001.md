---
task_key: T-E06-F02-001
status: todo
feature: /docs/plan/E06-intelligent-scanning/E06-F02-epic-feature-discovery
created: 2025-12-17
assigned_agent: backend
dependencies: []
estimated_time: 8 hours
---

# Task: Discovery Package Core Types and Interfaces

---

## Goal

Implement the foundational types, interfaces, and data structures for the epic/feature discovery package that will coordinate dual-source discovery (epic-index.md + folder scanning).

## What to Build

Create the `internal/discovery/` package with core type definitions, shared constants, and interfaces that all discovery components will use.

**Core Components**:

1. **Package Structure**: `internal/discovery/types.go`
   - DiscoveryOrchestrator struct definition
   - DiscoveryOptions configuration struct
   - DiscoveryReport result struct
   - Conflict types and enums
   - ConflictStrategy enum (index-precedence, folder-precedence, merge)
   - ValidationLevel enum (strict, balanced, permissive)

2. **Discovery Data Structures**:
   - IndexEpic, IndexFeature types (parsed from epic-index.md)
   - FolderEpic, FolderFeature types (scanned from filesystem)
   - DiscoveredEpic, DiscoveredFeature (merged results)
   - Conflict struct with detailed conflict information

3. **Pattern Configuration**:
   - Pattern Config types for epic/feature regex patterns
   - Named capture group constants
   - Default pattern definitions

## Why This Matters

This task establishes the foundation for the entire discovery engine. Clean type definitions enable parallel development of discovery components (index parser, folder scanner, conflict detector) that all share consistent data structures.

## Success Criteria

- [ ] `internal/discovery/types.go` created with all core types
- [ ] Types follow existing shark codebase conventions
- [ ] Documentation comments for all exported types
- [ ] No external dependencies beyond standard library and existing shark packages
- [ ] Types support JSON marshaling for reporting (json tags)
- [ ] Compilation succeeds with no errors

## Implementation Guidance

**Reference Design Documents**:
- PRD Section: "Functional Requirements" - Data structures implied by requirements
- Architecture Doc (`02-architecture.md`): Package Structure section
- Backend Design (`04-backend-design.md`): Type Definitions sections

**Key Patterns**:
- Follow repository pattern used in `internal/repository/`
- Use options struct pattern for configuration (like `SyncOptions`)
- Include JSON tags for API/CLI output compatibility

**Files to Create**:
- `internal/discovery/types.go` - Core type definitions
- `internal/discovery/constants.go` - Shared constants and enums

## Validation Requirements

- Ensure types compile successfully
- Verify JSON marshaling works for DiscoveryReport
- Check that ConflictStrategy enum covers all required strategies from PRD
- Validate that DiscoveryOptions includes all configuration needs from requirements

## Dependencies

**Depends On**: None (foundational task)

**Blocks**: T-E06-F02-002, T-E06-F02-003, T-E06-F02-004 (all discovery components)

## Estimated Effort

2-3 hours

## Agent Type

backend

## Priority

Critical (P1) - Blocks all other discovery tasks

## Notes for Implementation

- Keep types simple and focused - avoid premature optimization
- Ensure DiscoveryReport struct captures all required metrics from PRD success criteria
- Pattern Config should reference E05-F01 configuration system design
- Consider future extensibility but don't over-engineer for POC
