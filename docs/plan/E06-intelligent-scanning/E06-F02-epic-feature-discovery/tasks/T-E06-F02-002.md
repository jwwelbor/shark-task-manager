---
task_key: T-E06-F02-002
status: todo
feature: /docs/plan/E06-intelligent-scanning/E06-F02-epic-feature-discovery
created: 2025-12-17
assigned_agent: backend
dependencies: []
estimated_time: 8 hours
---

# Task: Epic-Index.md Parser Implementation

---

## Goal

Implement the epic-index.md parser that extracts epic and feature keys from markdown links, serving as the primary explicit source of truth for project structure.

## What to Build

Create the index parser component that reads epic-index.md files and extracts structured data about epics and features.

**Core Components**:

1. **IndexParser** (`internal/discovery/index_parser.go`):
   - Parse markdown files for epic/feature links
   - Extract epic keys from link patterns: `[Epic Name](./E##-epic-slug/)`
   - Extract feature keys from nested links: `[Feature Name](./E##-epic-slug/E##-F##-feature-slug/)`
   - Support both relative and absolute paths
   - Handle nested list structures (epics as top-level, features as nested)
   - Extract titles from link text

2. **Link Extraction Logic**:
   - Regex pattern matching for markdown links
   - Path normalization (handle ./, /, relative paths)
   - Epic/feature key extraction from paths
   - Title extraction from link text
   - Validation of link format

3. **Error Handling**:
   - Log warnings for broken links (path doesn't exist)
   - Handle invalid link formats gracefully
   - Continue parsing on errors (collect all errors, don't fail fast)

## Why This Matters

Epic-index.md provides an explicit, human-maintained declaration of project structure. Parsing it correctly enables index-precedence conflict resolution and reduces reliance on folder naming conventions.

## Success Criteria

- [ ] IndexParser struct implemented with Parse method
- [ ] Correctly extracts epic keys from markdown links
- [ ] Correctly extracts feature keys from nested markdown links
- [ ] Handles both unordered and ordered list formats
- [ ] Extracts titles from link text
- [ ] Logs warnings for broken or malformed links
- [ ] Returns structured IndexEpic and IndexFeature slices
- [ ] Unit tests cover various epic-index.md formats
- [ ] Parser continues on errors (collects all issues)

## Implementation Guidance

**Reference Design Documents**:
- PRD FR-001: epic-index.md Parsing requirements
- PRD FR-016: Epic-Index.md Format Support
- Backend Design (`04-backend-design.md`): IndexParser component

**Key Algorithms**:
- Use regex to match markdown link pattern: `\[([^\]]+)\]\(([^)]+)\)`
- Extract path from link, normalize to canonical form
- Parse epic key from path using configured patterns
- Associate features with parent epics based on path hierarchy

**Files to Create**:
- `internal/discovery/index_parser.go`
- `internal/discovery/index_parser_test.go`

## Validation Requirements

- Test with sample epic-index.md containing:
  - Standard E##-epic-slug links
  - Special epic types (tech-debt, bugs)
  - Nested feature links
  - Broken links (should warn, not fail)
  - Mixed list formats (ordered/unordered)
- Verify extracted data matches expected epics/features
- Check warning messages are actionable

## Dependencies

**Depends On**: T-E06-F02-001 (Core types)

**Blocks**: T-E06-F02-005 (Discovery orchestrator)

## Estimated Effort

4-5 hours

## Agent Type

backend

## Priority

High (P2)

## Notes for Implementation

- Reference existing markdown parsing in codebase (if any)
- Consider using goldmark or similar Go markdown library if needed
- Simple regex-based approach likely sufficient for POC
- Focus on robustness: handle malformed input gracefully
- Log detailed warnings to help users fix epic-index.md issues
