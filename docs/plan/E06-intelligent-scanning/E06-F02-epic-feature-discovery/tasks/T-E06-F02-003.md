---
task_key: T-E06-F02-003
status: todo
feature: /docs/plan/E06-intelligent-scanning/E06-F02-epic-feature-discovery
created: 2025-12-17
assigned_agent: backend
dependencies: []
estimated_time: 8 hours
---

# Task: Folder Scanner and Pattern Matching

---

## Goal

Implement the folder structure scanner that discovers epics and features by recursively scanning the documentation root and applying configured regex patterns to directory names.

## What to Build

Create the folder scanner component that walks the filesystem and matches folders against epic/feature patterns defined in configuration.

**Core Components**:

1. **FolderScanner** (`internal/discovery/folder_scanner.go`):
   - Recursive directory walking from docs root
   - Apply epic.folder patterns to directories
   - Apply feature.folder patterns to subdirectories
   - Extract epic/feature components using named capture groups
   - Build epic â†’ feature hierarchy from path structure
   - Track scan statistics (folders scanned, matched, skipped)

2. **Pattern Matching** (`internal/discovery/patterns.go`):
   - Load patterns from E05-F01 configuration system
   - Compile regex patterns once (cache compiled regexes)
   - Apply patterns in order (first match wins)
   - Extract named capture groups: epic_id, epic_slug, feature_id, etc.
   - Build canonical keys from extracted components

3. **Metadata Collection**:
   - Record file paths to epic.md, prd.md
   - Identify related documents in feature folders
   - Catalog non-task markdown files
   - Exclude hidden directories (starting with .)

## Why This Matters

Folder scanning provides fallback discovery when epic-index.md is absent and enables conflict detection when both sources exist. Pattern-based matching allows shark to adapt to varied documentation conventions.

## Success Criteria

- [ ] FolderScanner implemented with Scan method
- [ ] Recursively walks documentation tree
- [ ] Applies epic folder patterns correctly
- [ ] Applies feature folder patterns correctly
- [ ] Extracts components using named capture groups
- [ ] Builds epic/feature hierarchy from paths
- [ ] Returns FolderEpic and FolderFeature slices
- [ ] Tracks scan statistics accurately
- [ ] Unit tests cover various folder structures
- [ ] Performance: scans 100 folders in <5 seconds

## Implementation Guidance

**Reference Design Documents**:
- PRD FR-002: Folder Structure Fallback Scanning
- PRD FR-004: Feature Folder Pattern Matching
- PRD FR-011: Regex Pattern Application
- Backend Design (`04-backend-design.md`): FolderScanner component
- E05-F01 PRD: Pattern configuration system

**Key Algorithms**:
- Use filepath.Walk for recursive directory traversal
- Match directory base name against patterns
- Build full epic/feature keys from path components
- Maintain parent context to associate features with epics

**Files to Create**:
- `internal/discovery/folder_scanner.go`
- `internal/discovery/patterns.go`
- `internal/discovery/folder_scanner_test.go`

## Validation Requirements

- Test with directory structures:
  - Standard E##-epic-slug / E##-F##-feature-slug
  - Special epic types (tech-debt, bugs)
  - Mixed patterns within same project
  - Deeply nested structures
- Verify pattern matching first-match-wins semantics
- Check scan statistics accuracy
- Validate performance with large folder counts

## Dependencies

**Depends On**: T-E06-F02-001 (Core types)

**Blocks**: T-E06-F02-005 (Discovery orchestrator)

## Estimated Effort

5-6 hours

## Agent Type

backend

## Priority

High (P2)

## Notes for Implementation

- Use Go's filepath.Walk, not os.ReadDir (better for deep hierarchies)
- Cache compiled regexes in struct fields (don't recompile per folder)
- Skip hidden directories early to avoid wasted work
- Consider symlink handling (follow vs. skip)
- Log pattern match details in verbose mode for debugging
- Ensure thread-safety if parallelizing folder scanning (future)
