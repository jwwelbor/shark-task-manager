# User Acceptance Testing Guide - E07-F13: Remove Agent Type Restrictions

**Feature:** Remove Agent Type Restrictions
**Epic:** E07 - Enhancements
**UAT Date:** 2026-01-20
**Status:** Ready for Approval

## Feature Overview

This feature removes hardcoded agent type restrictions from Shark Task Manager, allowing users to specify any custom agent type string (e.g., "architect", "qa-lead", "product-manager") when creating tasks. The system now accepts any non-empty string as an agent type while maintaining 100% backward compatibility with the original 6 standard types (frontend, backend, api, testing, devops, general).

### What Was Built

**Tasks Completed:**
- T-E07-F13-001: Updated ValidateAgentType to accept any non-empty string
- T-E07-F13-002: Deprecated AgentType enum constants
- T-E07-F13-003: Updated template renderer to handle unknown agent types gracefully
- T-E07-F13-004: Verified task creation validator works with custom agent types
- T-E07-F13-005: Updated documentation (CLAUDE.md, README.md, CLI_REFERENCE.md)
- T-E07-F13-006: Added comprehensive tests for custom agent types

**Key Changes:**
- Validation now accepts any non-empty, trimmed string up to 100 characters
- Template system falls back to `task-general.md` for unknown agent types
- AgentType enum constants deprecated with migration guidance
- 40+ new test cases covering custom agent types
- Documentation updated throughout

## Prerequisites

- Shark Task Manager built and ready: `make build`
- Project root with database: `shark-tasks.db`
- Terminal access for CLI commands

## Test Scenarios

### Scenario 1: Create Task with Custom Agent Type

**Tasks covered:** T-E07-F13-001, T-E07-F13-003, T-E07-F13-004

**Steps:**
1. Create a task with custom agent type "architect":
   ```bash
   ./bin/shark task create E07 F13 "Design authentication system" --agent=architect
   ```

2. Verify task was created successfully and shows custom agent type:
   ```bash
   ./bin/shark task get T-E07-F13-XXX --json | jq '.agent_type'
   ```

3. Open the generated task file and verify frontmatter contains:
   ```yaml
   agent: architect
   ```

**Expected Results:**
- ✅ Task created without validation errors
- ✅ Agent type stored as "architect" in database
- ✅ Task file frontmatter shows `agent: architect`
- ✅ Template used `task-general.md` as fallback

**Success Criteria:**
- [ ] Task creation succeeds with custom agent type
- [ ] Agent type correctly stored and displayed
- [ ] No validation errors or warnings
- [ ] Template renders correctly with custom type

### Scenario 2: Backward Compatibility with Standard Types

**Tasks covered:** T-E07-F13-001, T-E07-F13-002

**Steps:**
1. Create tasks using all 6 standard agent types:
   ```bash
   ./bin/shark task create E07 F13 "Build UI" --agent=frontend
   ./bin/shark task create E07 F13 "Build API" --agent=backend
   ./bin/shark task create E07 F13 "Design API" --agent=api
   ./bin/shark task create E07 F13 "Write tests" --agent=testing
   ./bin/shark task create E07 F13 "Deploy" --agent=devops
   ./bin/shark task create E07 F13 "General task" --agent=general
   ```

2. Verify all tasks created successfully:
   ```bash
   ./bin/shark task list E07 F13
   ```

3. Check that deprecated constants still work (verify no breaking changes):
   ```bash
   go doc github.com/jwwelbor/shark-task-manager/internal/models.AgentType
   ```

**Expected Results:**
- ✅ All 6 standard types work exactly as before
- ✅ Specific templates used for known types (task-frontend.md, task-backend.md, etc.)
- ✅ Deprecation notices visible in `go doc` output
- ✅ No breaking changes or errors

**Success Criteria:**
- [ ] All standard agent types work unchanged
- [ ] Agent-specific templates still used for known types
- [ ] Deprecation notices visible but constants functional
- [ ] 100% backward compatibility maintained

### Scenario 3: Edge Cases and Validation

**Tasks covered:** T-E07-F13-001, T-E07-F13-004, T-E07-F13-006

**Steps:**
1. Test various custom agent type formats:
   ```bash
   # With hyphens
   ./bin/shark task create E07 F13 "Task 1" --agent=qa-lead

   # With underscores
   ./bin/shark task create E07 F13 "Task 2" --agent=data_engineer

   # Mixed case
   ./bin/shark task create E07 F13 "Task 3" --agent=ProductManager

   # Single character
   ./bin/shark task create E07 F13 "Task 4" --agent=x

   # Numbers
   ./bin/shark task create E07 F13 "Task 5" --agent=ml-engineer-v2
   ```

2. Test invalid inputs (should fail with clear errors):
   ```bash
   # Empty string
   ./bin/shark task create E07 F13 "Invalid 1" --agent=""

   # Whitespace only
   ./bin/shark task create E07 F13 "Invalid 2" --agent="   "

   # Too long (> 100 chars)
   ./bin/shark task create E07 F13 "Invalid 3" --agent="$(printf 'a%.0s' {1..101})"
   ```

**Expected Results:**
- ✅ All valid formats accepted (hyphens, underscores, mixed case, single char, numbers)
- ✅ Invalid inputs rejected with clear error messages
- ✅ Empty string error: "cannot be empty or whitespace-only"
- ✅ Too long error: "too long: maximum 100 characters"

**Success Criteria:**
- [ ] All valid edge cases accepted
- [ ] Invalid inputs rejected appropriately
- [ ] Error messages clear and actionable
- [ ] No crashes or unexpected behavior

### Scenario 4: Template Fallback Behavior

**Tasks covered:** T-E07-F13-003

**Steps:**
1. Create task with agent type that has no specific template:
   ```bash
   ./bin/shark task create E07 F13 "Custom workflow task" --agent=workflow-coordinator
   ```

2. Open the generated task file

3. Verify:
   - File exists and is readable
   - Uses general template structure
   - Frontmatter shows `agent: workflow-coordinator`
   - All template sections present (Goal, Requirements, Implementation Plan, etc.)

**Expected Results:**
- ✅ Task file created successfully
- ✅ General template used as fallback
- ✅ Custom agent type preserved in frontmatter
- ✅ Template rendered without errors

**Success Criteria:**
- [ ] Task file created for unknown agent type
- [ ] General template used automatically
- [ ] Agent type correctly preserved
- [ ] All sections rendered properly

### Scenario 5: Documentation Accuracy

**Tasks covered:** T-E07-F13-005

**Steps:**
1. Read updated documentation:
   - `README.md` - Quick start and examples
   - `docs/CLI_REFERENCE.md` - Full CLI reference
   - `.claude/rules/` - Development guidelines

2. Verify documentation states:
   - Agent type accepts "any non-empty string"
   - Examples show both standard and custom types
   - Template fallback behavior explained
   - Backward compatibility noted

3. Try examples from documentation:
   ```bash
   # From README.md
   ./bin/shark task create E07 F13 "Example task" --agent=architect
   ```

**Expected Results:**
- ✅ Documentation accurate and complete
- ✅ Examples work as described
- ✅ Custom agent types mentioned in multiple places
- ✅ Migration guidance provided

**Success Criteria:**
- [ ] Documentation clearly states custom types supported
- [ ] Examples include custom agent types
- [ ] All examples work as documented
- [ ] No conflicting or outdated information

### Scenario 6: Test Suite Execution

**Tasks covered:** T-E07-F13-006

**Steps:**
1. Run full test suite:
   ```bash
   make test
   ```

2. Check for test failures or regressions

3. Verify new tests executed:
   ```bash
   go test -v ./internal/models -run TestValidateAgentType
   go test -v ./internal/taskcreation -run TestValidator_CustomAgentType
   go test -v ./internal/templates -run TestRenderer.*CustomAgentType
   ```

4. Run benchmarks to verify no performance degradation:
   ```bash
   go test -bench=BenchmarkValidateAgentType ./internal/models
   ```

**Expected Results:**
- ✅ All tests pass (0 failures)
- ✅ 40+ new test cases executed
- ✅ Performance within acceptable range (< 1ms per validation)
- ✅ No regressions in existing functionality

**Success Criteria:**
- [ ] Full test suite passes
- [ ] All new tests executed and passing
- [ ] Performance acceptable (< 1ms)
- [ ] No regressions detected

## Performance Verification

**Benchmark Results:**
```
BenchmarkValidateAgentType_Standard    7.854 ns/op
BenchmarkValidateAgentType_Custom      6.810 ns/op
BenchmarkValidateAgentType_LongName    6.917 ns/op
```

**Expected Performance:**
- Agent type validation: < 10 nanoseconds
- Task creation with custom type: < 100ms
- Template rendering: < 50ms

**Success Criteria:**
- [ ] Validation under 1ms (actual: < 10ns ✓)
- [ ] Task creation under 200ms
- [ ] No memory leaks or excessive allocations

## Rollback Plan

If critical issues are found during UAT:

### Tasks to Revert
1. T-E07-F13-001 - `internal/models/validation.go`
2. T-E07-F13-002 - `internal/models/task.go` (deprecation comments)
3. T-E07-F13-003 - `internal/templates/renderer.go`, `internal/templates/task_templates/task-general.md`
4. T-E07-F13-006 - Test files (can be left, won't affect production)

### Rollback Procedure
```bash
# 1. Create rollback branch
git checkout -b rollback-e07-f13

# 2. Revert commits (find commit hashes first)
git log --oneline --grep="E07-F13" | head -10
git revert <commit-hash-1> <commit-hash-2> ...

# 3. Rebuild and test
make build
make test

# 4. If tests pass, merge rollback
git checkout main
git merge rollback-e07-f13
```

### Rollback Impact
- Custom agent types will be rejected again
- Standard 6 types will continue working
- Deprecation comments removed
- Test coverage reduced (but no functional impact)

## Sign-off

### Pre-Approval Checklist

- [ ] All 6 scenarios pass
- [ ] No critical bugs found
- [ ] Performance acceptable (< 10ns validation, < 100ms task creation)
- [ ] Documentation accurate
- [ ] Backward compatibility verified
- [ ] Test coverage adequate (40+ new tests)

### Approval Sign-off

**Tested By:** _______________ **Date:** ___________

**Approved By:** _______________ **Date:** ___________

**Comments:**
_________________________________________________________________
_________________________________________________________________
_________________________________________________________________

### Production Readiness

- [ ] All UAT scenarios passed
- [ ] No critical or high-severity bugs
- [ ] Performance metrics met
- [ ] Documentation complete
- [ ] Rollback plan tested (if needed)
- [ ] **Ready for production deployment**

---

**Generated by:** Build Feature Orchestrator
**Date:** 2026-01-20
**Feature:** E07-F13 - Remove Agent Type Restrictions
